<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Tree Editor - Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            padding: 15px;
            border-bottom: 2px solid #eee;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: none;
            background: #f8f9fa;
            padding: 10px;
            gap: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .tab-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .main-content {
            display: flex;
            gap: 20px;
            min-height: 500px;
        }

        .panel {
            padding: 20px;
            overflow-y: auto;
        }

        .tree-panel {
            flex: 1;
            background: #fafafa;
            border-right: 1px solid #eee;
            max-height: 600px;
        }

        .editor-panel {
            flex: 1;
            background: white;
            max-height: 600px;
        }

        /* Tree Styles */
        .tree {
            font-size: 14px;
        }

        .tree ul {
            list-style: none;
            margin: 0;
            padding-left: 0;
        }

        .tree li {
            margin: 3px 0;
            position: relative;
        }

        .tree li ul {
            margin-left: 20px;
        }

        .tree li::before {
            content: '';
            position: absolute;
            top: 12px;
            left: -12px;
            width: 10px;
            height: 1px;
            background: #999;
        }

        .tree li::after {
            content: '';
            position: absolute;
            left: -12px;
            top: -8px;
            bottom: 12px;
            width: 1px;
            background: #999;
        }

        .tree > ul > li::before,
        .tree > ul > li::after {
            display: none;
        }

        .scene-node, .choice-node {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            margin: 2px 0;
            user-select: none;
        }

        .scene-node {
            background: white;
            border: 2px solid #007bff;
        }

        .scene-node:active {
            transform: scale(0.98);
        }

        .scene-node.selected {
            background: #007bff;
            color: white;
        }

        .scene-node.empty {
            border-style: dashed;
            opacity: 0.6;
        }

        .scene-node.ending {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .choice-node {
            background: #f0f0f0;
            border: 1px solid #999;
            font-size: 12px;
        }

        .choice-node.selected {
            background: #6c757d;
            color: white;
        }

        /* Editor Styles */
        .editor-section {
            margin-bottom: 20px;
        }

        .editor-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .editor-input, .editor-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
        }

        .editor-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .choice-container {
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 12px;
            background: #f9f9f9;
        }

        .choice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .next-scene-control {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .next-scene-input {
            width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 16px;
        }

        .auto-btn {
            padding: 8px 12px;
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 13px;
        }

        .delete-btn {
            padding: 6px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 12px;
        }

        .add-choice-btn {
            padding: 10px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .editor-controls button {
            flex: 1;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
        }

        .checkbox-label input {
            width: 20px;
            height: 20px;
        }

        .status-bar {
            padding: 12px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            font-size: 13px;
            text-align: center;
        }

        .stats-info {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .stat-value {
            font-weight: bold;
            color: #007bff;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }

        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                border-radius: 0;
                box-shadow: none;
            }

            .header {
                position: sticky;
                top: 0;
                background: white;
                z-index: 100;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

            .title {
                font-size: 18px;
            }

            .buttons {
                gap: 5px;
            }

            button {
                padding: 8px 12px;
                font-size: 13px;
            }

            .tab-nav {
                display: flex;
                position: sticky;
                top: 60px;
                z-index: 99;
                background: white;
                border-bottom: 1px solid #ddd;
            }

            .main-content {
                flex-direction: column;
                gap: 0;
            }

            .panel {
                display: none;
                min-height: calc(100vh - 200px);
                max-height: none !important;
            }

            .panel.active {
                display: block;
            }

            .tree-panel {
                border-right: none;
                border-bottom: 1px solid #eee;
            }

            /* ëª¨ë°”ì¼ì—ì„œ íŠ¸ë¦¬ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
            .scene-node, .choice-node {
                padding: 10px 14px;
                font-size: 14px;
                margin: 4px 0;
            }

            .editor-input, .editor-textarea, .next-scene-input {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
            }

            .editor-controls {
                flex-direction: column;
            }

            .editor-controls button {
                width: 100%;
                padding: 12px;
            }

            .next-scene-control {
                flex-direction: column;
                align-items: stretch;
            }

            .next-scene-input {
                width: 100%;
            }

            .auto-btn {
                width: 100%;
                padding: 10px;
            }

            /* ìŠ¤í¬ë¡¤ ê°œì„  */
            .tree-panel, .editor-panel {
                -webkit-overflow-scrolling: touch;
                overflow-y: auto;
            }

            /* í„°ì¹˜ í”¼ë“œë°± */
            button:active, .scene-node:active, .choice-node:active {
                opacity: 0.8;
            }
        }

        /* íƒœë¸”ë¦¿ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .panel {
                max-height: 400px;
            }
        }

        /* ê°€ë¡œ ëª¨ë“œ ìµœì í™” */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 10px;
            }

            .title {
                font-size: 16px;
                margin-bottom: 5px;
            }

            .panel {
                min-height: calc(100vh - 150px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ® Game Tree Editor</h1>
            <div class="buttons">
                <button class="btn-primary" onclick="saveToLocal()">ğŸ’¾ ì €ì¥</button>
                <button class="btn-primary" onclick="loadFromLocal()">ğŸ“‚ ì—´ê¸°</button>
                <button class="btn-success" onclick="exportGame()">ğŸ¯ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn-danger" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('tree')">ğŸŒ³ íŠ¸ë¦¬</button>
            <button class="tab-btn" onclick="switchTab('editor')">âœï¸ í¸ì§‘</button>
        </div>

        <div class="main-content">
            <div class="panel tree-panel active" id="treePanel">
                <div class="tree" id="tree">
                    <div class="empty-state">ë¡œë”© ì¤‘...</div>
                </div>
            </div>

            <div class="panel editor-panel" id="editorPanel">
                <div id="editor">
                    <div class="empty-state">
                        íŠ¸ë¦¬ì—ì„œ ì”¬ì´ë‚˜ ì„ íƒì§€ë¥¼ íƒ­í•˜ì—¬ í¸ì§‘í•˜ì„¸ìš”
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div id="statusMessage">ì¤€ë¹„ë¨</div>
            <div class="stats-info">
                <div>ì‚¬ìš©: <span class="stat-value" id="usedScenes">1</span></div>
                <div>ë‚¨ìŒ: <span class="stat-value" id="availableScenes">999</span></div>
                <div>ì „ì²´: <span class="stat-value">1000</span></div>
            </div>
        </div>
    </div>

    <script>
        let gameData = {};
        let selectedNode = null;
        let selectedType = null;
        let usedSceneNumbers = new Set();
        let isMobile = window.innerWidth <= 768;

        // ëª¨ë°”ì¼ ê°ì§€ ë° ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
        });

        // íƒ­ ì „í™˜ (ëª¨ë°”ì¼)
        function switchTab(tab) {
            if (!isMobile) return;
            
            const treePanel = document.getElementById('treePanel');
            const editorPanel = document.getElementById('editorPanel');
            const tabBtns = document.querySelectorAll('.tab-btn');
            
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'tree') {
                treePanel.classList.add('active');
                editorPanel.classList.remove('active');
                tabBtns[0].classList.add('active');
            } else {
                treePanel.classList.remove('active');
                editorPanel.classList.add('active');
                tabBtns[1].classList.add('active');
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            for (let i = 1; i <= 1000; i++) {
                gameData[i] = {
                    content: '',
                    isEnding: false,
                    choices: []
                };
            }
            gameData[1].content = 'ê²Œì„ ì‹œì‘';
            updateUsedScenes();
            renderTree();
        }

        // ì‚¬ìš©ëœ ì”¬ ì—…ë°ì´íŠ¸
        function updateUsedScenes() {
            usedSceneNumbers.clear();
            usedSceneNumbers.add(1);
            
            function traverse(sceneNum) {
                const scene = gameData[sceneNum];
                if (!scene) return;
                
                scene.choices.forEach(choice => {
                    if (choice.next && choice.next > 0 && choice.next <= 1000) {
                        if (!usedSceneNumbers.has(choice.next)) {
                            usedSceneNumbers.add(choice.next);
                            traverse(choice.next);
                        }
                    }
                });
            }
            
            traverse(1);
            
            for (let i = 1; i <= 1000; i++) {
                if (gameData[i] && gameData[i].content && gameData[i].content.trim()) {
                    usedSceneNumbers.add(i);
                }
            }
            
            updateStats();
        }

        // ë‹¤ìŒ ì‚¬ìš© ê°€ëŠ¥í•œ ì”¬ ì°¾ê¸°
        function getNextAvailableScene() {
            for (let i = 2; i <= 1000; i++) {
                if (!usedSceneNumbers.has(i)) {
                    return i;
                }
            }
            return 0;
        }

        // íŠ¸ë¦¬ ë Œë”ë§
        function renderTree() {
            const treeDiv = document.getElementById('tree');
            const html = buildTreeHTML(1, new Set());
            treeDiv.innerHTML = html;
        }

        // íŠ¸ë¦¬ HTML ìƒì„±
        function buildTreeHTML(sceneNum, visited) {
            if (visited.has(sceneNum)) {
                return `<li><span class="scene-node empty">ì”¬ ${sceneNum} (ìˆœí™˜)</span></li>`;
            }

            visited.add(sceneNum);
            const scene = gameData[sceneNum];
            
            const hasContent = scene.content && scene.content.trim();
            const nodeClass = `scene-node ${hasContent ? '' : 'empty'} ${scene.isEnding ? 'ending' : ''} ${selectedNode === sceneNum && selectedType === 'scene' ? 'selected' : ''}`;
            
            let html = '<ul><li>';
            html += `<span class="${nodeClass}" onclick="selectScene(${sceneNum})">`;
            html += `ğŸ“„ ì”¬ ${sceneNum}`;
            if (hasContent) {
                const preview = scene.content.substring(0, 12);
                html += `: ${preview}${scene.content.length > 12 ? '...' : ''}`;
            }
            if (scene.isEnding) {
                html += ' [END]';
            }
            html += '</span>';
            
            if (!scene.isEnding && scene.choices.length > 0) {
                html += '<ul>';
                scene.choices.forEach((choice, index) => {
                    const choiceClass = `choice-node ${choice.text ? '' : 'empty'} ${selectedNode === `${sceneNum}-${index}` && selectedType === 'choice' ? 'selected' : ''}`;
                    html += '<li>';
                    html += `<span class="${choiceClass}" onclick="selectChoice(${sceneNum}, ${index})">`;
                    html += `â–¶ ${index + 1}. ${choice.text ? choice.text.substring(0, 15) + (choice.text.length > 15 ? '...' : '') : '(ë¹ˆ ì„ íƒì§€)'}`;
                    if (choice.next) {
                        html += ` â†’ ${choice.next}`;
                    }
                    html += '</span>';
                    
                    if (choice.next && choice.next > 0) {
                        html += buildTreeHTML(choice.next, new Set([...visited]));
                    }
                    
                    html += '</li>';
                });
                html += '</ul>';
            }
            
            html += '</li></ul>';
            
            return html;
        }

        // ì”¬ ì„ íƒ
        function selectScene(sceneNum) {
            selectedNode = sceneNum;
            selectedType = 'scene';
            renderTree();
            showSceneEditor(sceneNum);
            
            // ëª¨ë°”ì¼ì—ì„œëŠ” ìë™ìœ¼ë¡œ í¸ì§‘ íƒ­ìœ¼ë¡œ ì „í™˜
            if (isMobile) {
                switchTab('editor');
            }
        }

        // ì„ íƒì§€ ì„ íƒ
        function selectChoice(sceneNum, choiceIndex) {
            selectedNode = `${sceneNum}-${choiceIndex}`;
            selectedType = 'choice';
            renderTree();
            showChoiceEditor(sceneNum, choiceIndex);
            
            if (isMobile) {
                switchTab('editor');
            }
        }

        // ì”¬ ì—ë””í„°
        function showSceneEditor(sceneNum) {
            const scene = gameData[sceneNum];
            const editor = document.getElementById('editor');
            
            let html = `
                <div class="editor-section">
                    <h3 style="margin: 0 0 15px 0; color: #333;">ì”¬ ${sceneNum}</h3>
                </div>
                
                <div class="editor-section">
                    <div class="editor-label">ì”¬ ë‚´ìš©</div>
                    <textarea class="editor-textarea" id="sceneContent" 
                              placeholder="ì´ ì”¬ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...">${scene.content}</textarea>
                </div>
                
                <div class="editor-section">
                    <label class="checkbox-label">
                        <input type="checkbox" id="isEnding" ${scene.isEnding ? 'checked' : ''} 
                               onchange="toggleEnding(${sceneNum})">
                        <span>ì—”ë”© ì”¬ìœ¼ë¡œ ì„¤ì •</span>
                    </label>
                </div>
                
                <div class="editor-section" id="choicesSection" ${scene.isEnding ? 'style="display:none"' : ''}>
                    <div class="editor-label">ì„ íƒì§€ (${scene.choices.length}/3)</div>`;
            
            scene.choices.forEach((choice, index) => {
                html += `
                    <div class="choice-container">
                        <div class="choice-header">
                            <span class="choice-number">ì„ íƒì§€ ${index + 1}</span>
                            <button class="delete-btn" onclick="deleteChoice(${sceneNum}, ${index})">ì‚­ì œ</button>
                        </div>
                        <input type="text" class="editor-input" id="choice-text-${index}" 
                               placeholder="ì„ íƒì§€ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." value="${choice.text}">
                        <div class="next-scene-control">
                            <input type="number" class="next-scene-input" id="choice-next-${index}" 
                                   min="1" max="1000" value="${choice.next || ''}" 
                                   placeholder="ë‹¤ìŒ ì”¬ ë²ˆí˜¸">
                            <button class="auto-btn" onclick="autoAssignNext(${sceneNum}, ${index})">ìë™ ì±„ë²ˆ</button>
                        </div>
                    </div>`;
            });
            
            if (scene.choices.length < 3 && !scene.isEnding) {
                html += `<button class="add-choice-btn" onclick="addChoice(${sceneNum})">+ ì„ íƒì§€ ì¶”ê°€</button>`;
            }
            
            html += `</div>
                
                <div class="editor-controls">
                    <button class="btn-success" onclick="saveScene(${sceneNum})">ì €ì¥</button>
                    ${sceneNum !== 1 ? `<button class="btn-danger" onclick="deleteScene(${sceneNum})">ì”¬ ì‚­ì œ</button>` : ''}
                    ${isMobile ? `<button class="btn-info" onclick="switchTab('tree')">íŠ¸ë¦¬ë¡œ ëŒì•„ê°€ê¸°</button>` : ''}
                </div>`;
            
            editor.innerHTML = html;
        }

        // ì„ íƒì§€ ì—ë””í„°
        function showChoiceEditor(sceneNum, choiceIndex) {
            const choice = gameData[sceneNum].choices[choiceIndex];
            const editor = document.getElementById('editor');
            
            let html = `
                <div class="editor-section">
                    <h3 style="margin: 0 0 15px 0; color: #333;">ì”¬ ${sceneNum} - ì„ íƒì§€ ${choiceIndex + 1}</h3>
                </div>
                
                <div class="editor-section">
                    <div class="editor-label">ì„ íƒì§€ í…ìŠ¤íŠ¸</div>
                    <input type="text" class="editor-input" id="choiceText" 
                           placeholder="ì„ íƒì§€ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." value="${choice.text || ''}">
                </div>
                
                <div class="editor-section">
                    <div class="editor-label">ë‹¤ìŒ ì”¬ ë²ˆí˜¸</div>
                    <div class="next-scene-control">
                        <input type="number" class="editor-input" id="choiceNext" 
                               min="1" max="1000" value="${choice.next || ''}" 
                               placeholder="1-1000">
                        <button class="auto-btn" onclick="autoAssignNextForChoice(${sceneNum}, ${choiceIndex})">ìë™ ì±„ë²ˆ</button>
                    </div>
                </div>
                
                <div class="editor-controls">
                    <button class="btn-success" onclick="saveChoice(${sceneNum}, ${choiceIndex})">ì €ì¥</button>
                    <button class="btn-danger" onclick="deleteChoice(${sceneNum}, ${choiceIndex})">ì‚­ì œ</button>
                    ${isMobile ? `<button class="btn-info" onclick="switchTab('tree')">íŠ¸ë¦¬ë¡œ ëŒì•„ê°€ê¸°</button>` : ''}
                </div>`;
            
            editor.innerHTML = html;
        }

        // ì—”ë”© í† ê¸€
        function toggleEnding(sceneNum) {
            const isEnding = document.getElementById('isEnding').checked;
            gameData[sceneNum].isEnding = isEnding;
            
            const choicesSection = document.getElementById('choicesSection');
            if (isEnding) {
                choicesSection.style.display = 'none';
                gameData[sceneNum].choices = [];
            } else {
                choicesSection.style.display = 'block';
            }
            
            updateUsedScenes();
            renderTree();
        }

        // ìë™ ì±„ë²ˆ
        function autoAssignNext(sceneNum, choiceIndex) {
            const nextScene = getNextAvailableScene();
            if (nextScene > 0) {
                document.getElementById(`choice-next-${choiceIndex}`).value = nextScene;
                updateStatus(`ì”¬ ${nextScene} ìë™ í• ë‹¹`);
            } else {
                alert('ì‚¬ìš© ê°€ëŠ¥í•œ ì”¬ì´ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function autoAssignNextForChoice(sceneNum, choiceIndex) {
            const nextScene = getNextAvailableScene();
            if (nextScene > 0) {
                document.getElementById('choiceNext').value = nextScene;
                updateStatus(`ì”¬ ${nextScene} ìë™ í• ë‹¹`);
            } else {
                alert('ì‚¬ìš© ê°€ëŠ¥í•œ ì”¬ì´ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ì”¬ ì €ì¥
        function saveScene(sceneNum) {
            const content = document.getElementById('sceneContent').value;
            const isEnding = document.getElementById('isEnding').checked;
            
            gameData[sceneNum].content = content;
            gameData[sceneNum].isEnding = isEnding;
            
            if (!isEnding) {
                gameData[sceneNum].choices.forEach((choice, index) => {
                    const textInput = document.getElementById(`choice-text-${index}`);
                    const nextInput = document.getElementById(`choice-next-${index}`);
                    if (textInput) choice.text = textInput.value;
                    if (nextInput) choice.next = parseInt(nextInput.value) || 0;
                });
            }
            
            updateUsedScenes();
            renderTree();
            saveToLocal();
            updateStatus('ì”¬ ' + sceneNum + ' ì €ì¥ë¨');
            
            if (isMobile) {
                setTimeout(() => switchTab('tree'), 500);
            }
        }

        // ì„ íƒì§€ ì €ì¥
        function saveChoice(sceneNum, choiceIndex) {
            const text = document.getElementById('choiceText').value;
            const next = parseInt(document.getElementById('choiceNext').value) || 0;
            
            gameData[sceneNum].choices[choiceIndex] = { text, next };
            
            updateUsedScenes();
            renderTree();
            saveToLocal();
            updateStatus('ì„ íƒì§€ ì €ì¥ë¨');
            
            if (isMobile) {
                setTimeout(() => switchTab('tree'), 500);
            }
        }

        // ì„ íƒì§€ ì¶”ê°€
        function addChoice(sceneNum) {
            if (gameData[sceneNum].choices.length < 3) {
                gameData[sceneNum].choices.push({ text: '', next: 0 });
                showSceneEditor(sceneNum);
                updateStatus('ì„ íƒì§€ ì¶”ê°€ë¨');
            }
        }

        // ì„ íƒì§€ ì‚­ì œ
        function deleteChoice(sceneNum, choiceIndex) {
            if (confirm('ì„ íƒì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gameData[sceneNum].choices.splice(choiceIndex, 1);
                updateUsedScenes();
                renderTree();
                if (selectedType === 'choice') {
                    showSceneEditor(sceneNum);
                }
                saveToLocal();
                updateStatus('ì„ íƒì§€ ì‚­ì œë¨');
            }
        }

        // ì”¬ ì‚­ì œ
        function deleteScene(sceneNum) {
            if (sceneNum === 1) {
                alert('ì”¬ 1ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            if (confirm(`ì”¬ ${sceneNum}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                gameData[sceneNum] = {
                    content: '',
                    isEnding: false,
                    choices: []
                };
                updateUsedScenes();
                renderTree();
                document.getElementById('editor').innerHTML = '<div class="empty-state">íŠ¸ë¦¬ì—ì„œ ì”¬ì´ë‚˜ ì„ íƒì§€ë¥¼ íƒ­í•˜ì—¬ í¸ì§‘í•˜ì„¸ìš”</div>';
                saveToLocal();
                updateStatus('ì”¬ ' + sceneNum + ' ì‚­ì œë¨');
                
                if (isMobile) {
                    switchTab('tree');
                }
            }
        }

        // ë¡œì»¬ ì €ì¥
        function saveToLocal() {
            localStorage.setItem('gameTreeDataMobile', JSON.stringify(gameData));
        }

        // ë¡œì»¬ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocal() {
            const saved = localStorage.getItem('gameTreeDataMobile');
            if (saved) {
                gameData = JSON.parse(saved);
                updateUsedScenes();
                renderTree();
                updateStatus('ë°ì´í„° ë¶ˆëŸ¬ì˜´');
            } else {
                updateStatus('ì €ì¥ëœ ë°ì´í„° ì—†ìŒ');
            }
        }

        // ì´ˆê¸°í™”
        function clearAll() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                init();
                document.getElementById('editor').innerHTML = '<div class="empty-state">íŠ¸ë¦¬ì—ì„œ ì”¬ì´ë‚˜ ì„ íƒì§€ë¥¼ íƒ­í•˜ì—¬ í¸ì§‘í•˜ì„¸ìš”</div>';
                saveToLocal();
                updateStatus('ì´ˆê¸°í™” ì™„ë£Œ');
            }
        }

        // ê²Œì„ ë‚´ë³´ë‚´ê¸°
        function exportGame() {
            const gameHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .game-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .scene-content {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            white-space: pre-wrap;
        }
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .choice-btn {
            padding: 15px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        .choice-btn:active {
            transform: scale(0.98);
        }
        .ending {
            text-align: center;
            font-size: 24px;
            color: #dc3545;
            font-weight: bold;
            padding: 20px;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .game-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="scene-content" id="content"></div>
        <div class="choices" id="choices"></div>
    </div>
    <script>
        const gameData = ${JSON.stringify(gameData)};
        
        function showScene(sceneNum) {
            const scene = gameData[sceneNum];
            if (!scene) return;
            
            document.getElementById('content').textContent = scene.content || 'ë‚´ìš© ì—†ìŒ';
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            if (scene.isEnding) {
                choicesDiv.innerHTML = '<div class="ending">~ THE END ~</div>';
            } else if (scene.choices && scene.choices.length > 0) {
                scene.choices.forEach((choice, index) => {
                    if (choice.text) {
                        const btn = document.createElement('button');
                        btn.className = 'choice-btn';
                        btn.textContent = (index + 1) + '. ' + choice.text;
                        btn.onclick = () => {
                            if (choice.next && choice.next > 0) {
                                showScene(choice.next);
                            }
                        };
                        choicesDiv.appendChild(btn);
                    }
                });
            }
        }
        
        showScene(1);
    <\/script>
</body>
</html>`;
            
            const blob = new Blob([gameHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'game.html';
            a.click();
            URL.revokeObjectURL(url);
            updateStatus('ê²Œì„ íŒŒì¼ ìƒì„±ë¨');
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
            updateStats();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const used = usedSceneNumbers.size;
            const available = 1000 - used;
            
            document.getElementById('usedScenes').textContent = used;
            document.getElementById('availableScenes').textContent = available;
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            const saved = localStorage.getItem('gameTreeDataMobile');
            if (saved) {
                gameData = JSON.parse(saved);
                updateUsedScenes();
                renderTree();
            } else {
                init();
            }
            
            // ë°ìŠ¤í¬í†±ì—ì„œëŠ” íŒ¨ë„ ëª¨ë‘ í‘œì‹œ
            if (!isMobile) {
                document.getElementById('treePanel').classList.add('active');
                document.getElementById('editorPanel').classList.add('active');
            }
        };
    </script>
</body>
</html>