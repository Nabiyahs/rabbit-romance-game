<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch! Love - Game</title>
    <!--
      ë””ìì¸/ë¬¸êµ¬ëŠ” ì›ë³¸ ìœ ì§€, ìŠ¤í† ë¦¬ëŠ” ë‚´ì¥ ìƒìˆ˜ë¡œ ì…ë ¥, JSON import/export ì§€ì›
      ë‹¨ì¼ HTML íŒŒì¼ë¡œ ì™„ê²°. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬/ë²ˆë“¤ëŸ¬ ë¶ˆê°€.

      ë³‘í•© ê·œì¹™(Merge Rules):
      1. Scene ë³‘í•©: scene.id ê¸°ì¤€
         - ì¡´ì¬í•˜ë©´: ë¹ˆ ê°’ì´ ì•„ë‹Œ í•„ë“œë§Œ ë®ì–´ì“°ê¸°
         - ì—†ìœ¼ë©´: scenes ë°°ì—´ì— ì¶”ê°€
      2. Choice ë³‘í•©: choice.id ê¸°ì¤€
         - ì¡´ì¬í•˜ë©´: label, outcome, nextSceneId ê°±ì‹ 
         - ì—†ìœ¼ë©´: í•´ë‹¹ ì”¬ì˜ choices[index] êµì²´
      3. startSceneId, titleì€ incoming ê°’ì´ ìˆìœ¼ë©´ ê°±ì‹ 
    -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==================== Utility Bar ==================== */
        .utility-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .utility-bar button,
        .utility-bar label {
            padding: 8px 15px;
            background: white;
            border: 2px solid #E64398;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #E64398;
            transition: all 0.2s;
            font-family: 'Lato', sans-serif;
        }

        .utility-bar button:hover,
        .utility-bar label:hover {
            background: #E64398;
            color: white;
        }

        .utility-bar input[type="file"] {
            display: none;
        }

        /* ==================== Common ==================== */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ==================== Main Game Screen ==================== */
        #main-screen {
            background: #F0EBF4;
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
        }

        .wave-decoration {
            position: absolute;
            z-index: 0;
        }

        .wave-top-left {
            top: 0;
            left: 0;
            width: 300px;
            height: 150px;
            background: #A1C3D1;
            border-radius: 0 0 100% 0;
            opacity: 0.4;
        }

        .wave-bottom-right {
            bottom: 0;
            right: 0;
            width: 350px;
            height: 180px;
            background: #B39BC8;
            border-radius: 100% 0 0 0;
            opacity: 0.4;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .game-title {
            font-size: 42px;
            color: #E64398;
            margin-bottom: 10px;
            font-weight: 900;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .header::before,
        .header::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            top: 50%;
            transform: translateY(-50%);
        }

        .header::before {
            left: calc(50% - 200px);
        }

        .header::after {
            right: calc(50% - 200px);
        }

        .scene-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 15px 40px rgba(179, 155, 200, 0.2);
            border: 4px solid #F172A1;
        }

        .scene-image-placeholder {
            width: 100%;
            height: 300px;
            background: #A1C3D1;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .scene-image-placeholder::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: #B39BC8;
            border-radius: 50% 50% 0 0;
        }

        .scene-image-placeholder span {
            font-size: 24px;
            color: white;
            font-weight: 700;
            z-index: 1;
            letter-spacing: 2px;
        }

        .scene-text {
            font-size: 18px;
            line-height: 1.8;
            color: #5a5a5a;
            text-align: center;
            padding: 30px;
            background: #F0EBF4;
            border-radius: 15px;
            border-left: 6px solid #E64398;
            font-weight: 400;
            white-space: pre-wrap;
        }

        .choices-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .choice-card {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(161, 195, 209, 0.2);
            border: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .choice-card:nth-child(1) {
            border-color: #A1C3D1;
        }

        .choice-card:nth-child(1):hover {
            border-color: #F172A1;
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(241, 114, 161, 0.3);
        }

        .choice-card:nth-child(1):hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 1;
        }

        .choice-card:nth-child(2) {
            border-color: #B39BC8;
        }

        .choice-card:nth-child(2):hover {
            border-color: #E64398;
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(230, 67, 152, 0.3);
        }

        .choice-card:nth-child(2):hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 1;
        }

        .choice-content {
            position: relative;
            z-index: 1;
        }

        .choice-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 25px;
            display: block;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .choice-card:nth-child(1) .choice-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .choice-card:nth-child(2) .choice-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .choice-label {
            font-size: 14px;
            color: #B39BC8;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .choice-text {
            font-size: 20px;
            color: #333;
            line-height: 1.6;
            font-weight: 400;
        }

        .choice-card:hover .choice-text {
            color: #E64398;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .choices-container {
                flex-direction: column;
            }
        }

        /* ==================== Ending Success Screen ==================== */
        #ending-success-screen {
            background: #F172A1;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .wave-celebration {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .celebrate-wave {
            position: absolute;
            width: 130%;
            left: -15%;
        }

        .celebrate-wave-1 {
            background: #E64398;
            height: 140px;
            top: 10%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .celebrate-wave-2 {
            background: #B39BC8;
            height: 160px;
            top: 35%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .celebrate-wave-3 {
            background: #A1C3D1;
            height: 180px;
            bottom: 15%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .ending-container {
            max-width: 850px;
            width: 100%;
            background: white;
            border-radius: 35px;
            padding: 70px 60px;
            box-shadow: 0 25px 70px rgba(230, 67, 152, 0.4);
            text-align: center;
            border: 6px solid #E64398;
            z-index: 10;
            position: relative;
        }

        .ending-container::before,
        .ending-container::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .ending-container::before {
            top: 25px;
            left: 25px;
        }

        .ending-container::after {
            bottom: 25px;
            right: 25px;
        }

        .icon-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .story-text-area {
            background: #F0EBF4;
            border: 5px solid #F172A1;
            border-radius: 25px;
            padding: 50px;
            min-height: 280px;
            margin-bottom: 50px;
            font-size: 18px;
            line-height: 1.9;
            color: #666;
            text-align: left;
            font-weight: 400;
            white-space: pre-wrap;
        }

        .story-text-area::before {
            content: '[Your beautiful love story concludes here...]';
            color: #F172A1;
            font-style: italic;
            display: block;
            text-align: center;
            margin-bottom: 25px;
            font-size: 16px;
            font-weight: 300;
        }

        .ending-message {
            font-size: 64px;
            color: #E64398;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 8px;
            margin-bottom: 30px;
        }

        .congratulations {
            font-size: 24px;
            color: #E64398;
            font-style: italic;
            margin-top: 25px;
            font-weight: 400;
        }

        .success-decoration {
            margin-top: 40px;
            padding: 30px;
            background: #B39BC8;
            border-radius: 20px;
            color: white;
            font-size: 20px;
            box-shadow: 0 10px 30px rgba(179, 155, 200, 0.3);
            font-weight: 400;
        }

        .hearts-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .hearts-row .heart-icon {
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .hearts-row .heart-icon:nth-child(1) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(2) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(3) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(4) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(5) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        /* ==================== Ending Failure Screen ==================== */
        #ending-failure-screen {
            background: #A1C3D1;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        #ending-failure-screen .ending-container {
            border-color: #B39BC8;
        }

        #ending-failure-screen .ending-container::before,
        #ending-failure-screen .ending-container::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 0.3;
        }

        #ending-failure-screen .icon-container {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            width: 80px;
            height: 80px;
            opacity: 0.5;
            animation: none;
        }

        #ending-failure-screen .story-text-area {
            border-color: #B39BC8;
            padding: 40px;
            min-height: 250px;
            margin-bottom: 40px;
        }

        #ending-failure-screen .story-text-area::before {
            content: '[Story text will appear here]';
            color: #B39BC8;
        }

        #ending-failure-screen .ending-message {
            font-size: 48px;
            color: #A1C3D1;
            letter-spacing: 6px;
        }

        .encouragement {
            font-size: 20px;
            color: #B39BC8;
            font-style: italic;
            margin-top: 20px;
            font-weight: 400;
        }

        .retry-hint {
            margin-top: 40px;
            padding: 25px;
            background: #F172A1;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 400;
        }

        /* ==================== Split Panel System ==================== */
        .split-panel-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .panel-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .panel-tab {
            padding: 8px 16px;
            background: white;
            border: 2px solid #B39BC8;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #B39BC8;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .panel-tab:hover, .panel-tab.active {
            background: #B39BC8;
            color: white;
        }

        .panel-tab .toggle-icon {
            font-size: 10px;
            transition: transform 0.2s;
        }

        .panel-tab.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .expand-btn {
            margin-left: auto;
            padding: 6px 12px;
            background: #E64398;
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .expand-btn:hover {
            background: #F172A1;
        }

        .split-panels {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 3px solid #F172A1;
        }

        .panel.collapsed {
            max-height: 0;
            border: none;
            margin: 0;
            padding: 0;
        }

        .panel.expanded {
            flex: 1;
        }

        .panel-header {
            background: linear-gradient(135deg, #F172A1 0%, #E64398 100%);
            color: white;
            padding: 12px 20px;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content {
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .panel.expanded .panel-content {
            max-height: 500px;
        }

        /* Story Preview Panel Styles */
        .preview-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .preview-tab {
            padding: 6px 14px;
            background: #F0EBF4;
            border: 2px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s;
        }

        .preview-tab:hover, .preview-tab.active {
            background: #E64398;
            color: white;
        }

        .story-path {
            background: #F0EBF4;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #E64398;
        }

        .path-header {
            font-weight: 700;
            color: #E64398;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .path-ending-tag {
            background: #B39BC8;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .path-ending-tag.success {
            background: #4CAF50;
        }

        .path-step {
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
            font-size: 13px;
            line-height: 1.5;
        }

        .path-step:last-child {
            border-bottom: none;
        }

        .path-scene-id {
            color: #E64398;
            font-weight: 700;
            margin-right: 8px;
        }

        .path-scene-content {
            color: #666;
            display: block;
            margin: 4px 0;
            padding-left: 10px;
            border-left: 2px solid #A1C3D1;
            font-size: 12px;
        }

        .path-choice {
            color: #B39BC8;
            font-style: italic;
            display: block;
            margin-top: 4px;
            padding-left: 20px;
        }

        .path-choice::before {
            content: "â†³ ";
            color: #E64398;
        }

        .path-ending {
            color: #E64398;
            font-weight: 600;
            margin-top: 8px;
            padding: 8px;
            background: rgba(230, 67, 152, 0.1);
            border-radius: 8px;
        }

        /* Current Scene Panel Styles */
        .current-scene-display {
            text-align: center;
        }

        .current-scene-id {
            font-size: 18px;
            color: #E64398;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .current-scene-text {
            background: #F0EBF4;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 15px;
            white-space: pre-wrap;
            text-align: left;
        }

        .current-choices-display {
            display: flex;
            gap: 10px;
        }

        .choice-preview {
            flex: 1;
            background: #F0EBF4;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            text-align: left;
        }

        .choice-preview-label {
            color: #B39BC8;
            font-weight: 700;
            font-size: 11px;
            margin-bottom: 5px;
        }

        .choice-preview-text {
            color: #333;
        }

        .choice-preview-next {
            color: #E64398;
            font-size: 11px;
            margin-top: 5px;
            font-weight: 600;
        }

        .scene-navigator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .nav-btn {
            padding: 6px 14px;
            background: #A1C3D1;
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: #E64398;
        }

        .scene-select {
            padding: 6px 12px;
            border: 2px solid #B39BC8;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
        }

        /* Ending summary styles */
        .ending-summary {
            background: #F0EBF4;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .ending-summary-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .ending-code {
            background: #E64398;
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 700;
        }

        .ending-title {
            font-weight: 700;
            color: #333;
        }

        .ending-paths-count {
            color: #666;
            font-size: 12px;
        }

        .wave-background {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .bg-wave {
            position: absolute;
            width: 120%;
            left: -10%;
        }

        .bg-wave-1 {
            background: #B39BC8;
            height: 150px;
            top: 20%;
            border-radius: 50%;
            opacity: 0.3;
        }

        .bg-wave-2 {
            background: #F172A1;
            height: 120px;
            bottom: 25%;
            border-radius: 50%;
            opacity: 0.3;
        }

        /* Restart button for ending screens */
        .restart-button {
            margin-top: 40px;
            padding: 15px 40px;
            background: #E64398;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lato', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .restart-button:hover {
            background: #F172A1;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(230, 67, 152, 0.3);
        }
    </style>
</head>
<body>
    <!-- Utility Bar -->
    <div class="utility-bar">
        <button id="btn-export" aria-label="JSON ë‚´ë³´ë‚´ê¸°">ğŸ’¾ Export</button>
        <label aria-label="JSON ë¶ˆëŸ¬ì˜¤ê¸°">
            ğŸ“‚ Import
            <input type="file" id="input-import" accept=".json">
        </label>
    </div>

    <!-- Main Game Screen -->
    <div id="main-screen" class="screen active">
        <div class="wave-decoration wave-top-left"></div>
        <div class="wave-decoration wave-bottom-right"></div>

        <div class="game-container">
            <div class="header">
                <h1 class="game-title">ğŸ’• CATCH! LOVE ğŸ’•</h1>
            </div>

            <!-- Split Panel System -->
            <div class="split-panel-container">
                <div class="panel-tabs">
                    <button class="panel-tab active" id="tab-preview" data-panel="preview">
                        <span class="toggle-icon">â–¼</span> ìŠ¤í† ë¦¬ í”„ë¦¬ë·°
                    </button>
                    <button class="panel-tab active" id="tab-current" data-panel="current">
                        <span class="toggle-icon">â–¼</span> í˜„ì¬ ì”¬
                    </button>
                    <button class="expand-btn" id="expand-btn">â¬† í™•ì¥</button>
                </div>

                <div class="split-panels">
                    <!-- Story Preview Panel -->
                    <div class="panel" id="panel-preview">
                        <div class="panel-header">ğŸ“– ìŠ¤í† ë¦¬ í”„ë¦¬ë·°</div>
                        <div class="panel-content">
                            <div class="preview-tabs">
                                <button class="preview-tab active" data-view="paths">ì „ì²´ ê²½ë¡œ</button>
                                <button class="preview-tab" data-view="endings">ì—”ë”©ë³„</button>
                                <button class="preview-tab" data-view="map">ì”¬ ë§µ</button>
                            </div>
                            <div id="preview-content">
                                <!-- ê²½ë¡œë“¤ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>

                    <!-- Current Scene Panel -->
                    <div class="panel" id="panel-current">
                        <div class="panel-header">ğŸ¬ í˜„ì¬ ì”¬ ë³´ê¸°</div>
                        <div class="panel-content">
                            <div class="current-scene-display">
                                <div class="current-scene-id" id="current-scene-id">S001</div>
                                <div class="current-scene-text" id="current-scene-text"></div>
                                <div class="current-choices-display">
                                    <div class="choice-preview">
                                        <div class="choice-preview-label">Option A</div>
                                        <div class="choice-preview-text" id="current-choice-a"></div>
                                        <div class="choice-preview-next" id="current-choice-a-next"></div>
                                    </div>
                                    <div class="choice-preview">
                                        <div class="choice-preview-label">Option B</div>
                                        <div class="choice-preview-text" id="current-choice-b"></div>
                                        <div class="choice-preview-next" id="current-choice-b-next"></div>
                                    </div>
                                </div>
                                <div class="scene-navigator">
                                    <button class="nav-btn" id="nav-prev">â—€ ì´ì „</button>
                                    <select class="scene-select" id="scene-select"></select>
                                    <button class="nav-btn" id="nav-next">ë‹¤ìŒ â–¶</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="scene-container">
                <div class="scene-image-placeholder">
                    <span>SCENE IMAGE</span>
                </div>
                <div class="scene-text" id="scene-content"></div>
            </div>

            <div class="choices-container">
                <div class="choice-card" id="choice-a" data-choice="0">
                    <div class="choice-content">
                        <div class="choice-icon"></div>
                        <div class="choice-label">Option A</div>
                        <div class="choice-text" id="choice-a-text"></div>
                    </div>
                </div>

                <div class="choice-card" id="choice-b" data-choice="1">
                    <div class="choice-content">
                        <div class="choice-icon"></div>
                        <div class="choice-label">Option B</div>
                        <div class="choice-text" id="choice-b-text"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ending Success Screen -->
    <div id="ending-success-screen" class="screen">
        <div class="wave-celebration">
            <div class="celebrate-wave celebrate-wave-1"></div>
            <div class="celebrate-wave celebrate-wave-2"></div>
            <div class="celebrate-wave celebrate-wave-3"></div>
        </div>

        <div class="ending-container">
            <div class="icon-container"></div>

            <div class="story-text-area" id="success-story-text"></div>

            <div class="hearts-row">
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
            </div>

            <div class="ending-message">THE END</div>

            <div class="congratulations">
                Congratulations! You've caught love! ğŸ‰
            </div>

            <div class="success-decoration">
                True love conquers all. Your hearts are now forever intertwined! ğŸ’‘
            </div>

            <button class="restart-button" id="restart-success">Restart Journey</button>
        </div>
    </div>

    <!-- Ending Failure Screen -->
    <div id="ending-failure-screen" class="screen">
        <div class="wave-background">
            <div class="bg-wave bg-wave-1"></div>
            <div class="bg-wave bg-wave-2"></div>
        </div>

        <div class="ending-container">
            <div class="icon-container"></div>

            <div class="story-text-area" id="failure-story-text"></div>

            <div class="ending-message">MAYBE NEXT TIME...</div>

            <div class="encouragement">
                Every ending is a new beginning. Try again? ğŸ’«
            </div>

            <div class="retry-hint">
                Love is a journey of many paths. Choose differently and discover new possibilities! ğŸŒˆ
            </div>

            <button class="restart-button" id="restart-failure">Restart Journey</button>
        </div>
    </div>

    <script>
        // ==================== STORY DATA ====================
        let STORY = {
            title: "Catch! Love",
            startSceneId: "S001",
            scenes: [
                {
                    id: "S001",
                    name: "ì”¬ 1",
                    content: "ì˜¤ëŠ˜ë„ ì§€ê²¨ìš´ íšŒì‚¬... ë‹´íƒ€ë¥¼ ê°€ì§€ëŸ¬ ì´ë™í•˜ë˜ ì¤‘ ìƒˆë¡œ ì˜¨ í†µì—­ì‚¬ë¥¼ ë´¤ë‹¤. \në‚´ ìŠ¤íƒ€ì¼ì¸ë°?",
                    isEnding: false,
                    choices: [
                        { id: "C001A", label: "ì–¼ë¥¸ ìê¸°ì†Œê°œë¥¼ í•œë‹¤.", outcome: "continue", nextSceneId: "S002" },
                        { id: "C001B", label: "ì œ ìŠ¤íƒ€ì¼ì´ì‹œë„¤ìš”. ì €ë‘ ì˜ë˜ìš”?", outcome: "continue", nextSceneId: "S003" }
                    ]
                },
                {
                    id: "S002",
                    name: "ì”¬ 2",
                    content: "\"ì•ˆë…•í•˜ì„¸ìš”, ì„±ì—°ì£¼ì…ë‹ˆë‹¤.\"\n\"ì•ˆë…•í•˜ì„¸ìš”? ì¡°í¬ìˆ˜ì˜ˆìš”.\"\n\nì¡°í¬ìˆ˜... ì´ ì‚¬ëŒê³¼ ê°€ê¹Œì›Œì§€ê³  ì‹¶ë‹¤.",
                    isEnding: false,
                    choices: [
                        { id: "C002A", label: "ë§ˆìŒì´ ê¸‰í•˜ë‹ˆ ë¹ ë¥´ê²Œ ë‹¤ê°€ê°„ë‹¤.", outcome: "continue", nextSceneId: "S006" },
                        { id: "C002B", label: "ë­˜ ì¢‹ì•„í•˜ëŠ”ì§€ ì¡°ìš©íˆ ê´€ì°°í•œë‹¤.", outcome: "continue", nextSceneId: "S004" }
                    ]
                },
                {
                    id: "S003",
                    name: "ì”¬ 3",
                    content: "\"í•˜í•˜... ì´ìƒí˜• ë§Œë‚˜ì‹  ê±° ì¶•í•˜ë“œë ¤ìš”.\"\n\në‚˜ëŠ” ë„ˆë¬´ ì„œë‘ë¥´ë‹¤ê°€ ì†”ë¡œê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-3", title: "ì—”ë”© 3", summary: "\"í•˜í•˜... ì´ìƒí˜• ë§Œë‚˜ì‹  ê±° ì¶•í•˜ë“œë ¤ìš”.\"\n\në‚˜ëŠ” ë„ˆë¬´ ì„œë‘ë¥´ë‹¤ê°€ ì†”ë¡œê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C003A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C003B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S004",
                    name: "ì”¬ 4",
                    content: "ì•„ì¹¨ë§ˆë‹¤ ì½œë“œë¸Œë£¨ë¥¼ ë§ˆì‹œëŠ” ê·¸ë…€ ì£¼ìœ„ë¥¼ ê¸°ì›ƒê±°ë¦¬ë‹¤ê°€ \nì–¼ê²°ì— ì»¤í”¼ë¥¼ ëª‡ ë²ˆ ì–»ì–´ë§ˆì…¨ë‹¤.\nëª…ìƒ‰ì´ ê·¸ë˜ë„ ì˜¨ê¹ì¸ë°... ì»¤í”¼ê¹ë§Œ ë°›ì„ ìˆœ ì—†ì§€!",
                    isEnding: false,
                    choices: [
                        { id: "C004A", label: "í†µ í¬ê²Œ ì»¤í”¼ í•œ ë³‘ì„ ì„ ë¬¼í•œë‹¤.", outcome: "continue", nextSceneId: "S005" },
                        { id: "C004B", label: "ì¹´í˜ì—ì„œ ë§Œë‚˜ìê³  í•œë‹¤.", outcome: "continue", nextSceneId: "S006" }
                    ]
                },
                {
                    id: "S005",
                    name: "ì”¬ 5",
                    content: "ê·¸ë…€ê°€ ë¶€ë‹´ìŠ¤ëŸ¬ì›Œí•˜ì§€ë§Œ ì¼ë‹¨ ë°›ì•„ì¤€ë‹¤.\ní•œ ë°œ ë” ë‹¤ê°€ê°€ë³¸ë‹¤.",
                    isEnding: false,
                    choices: [
                        { id: "C005A", label: "ì£¼ë§ì— ë§›ìˆëŠ” ì»¤í”¼ ë§ˆì‹œëŸ¬ ì¹´í˜ ê°ˆê¹Œìš”?", outcome: "continue", nextSceneId: "S007" },
                        { id: "C005B", label: "ìì „ê±° íƒ€ê³  ìš©ì‚° ê°€ì„œ ì˜í™” ë³¸ ë‹¤ìŒì— ì‹œì›í•œ ì»¤í”¼ ë§ˆì…”ìš”.", outcome: "continue", nextSceneId: "S008" }
                    ]
                },
                {
                    id: "S006",
                    name: "ì”¬ 6",
                    content: "\"ìš°ë¦¬ ì£¼ë§ì— ì»¤í”¼ í•œ ì” í• ë˜ìš”? ì•„, ë¬¼ë¡  ì œê°€ ê¹... ì•„ë‹ˆ ì‚´ê²Œìš”.\"\nì–´ë¼, ê·¸ë…€ê°€ ì›ƒëŠ”ë‹¤. \nê³„ì† ì›ƒìœ¼ë©° ì¡°ìš©íˆ ë©€ì–´ì ¸ê°€ëŠ” ê·¸ë…€... \n\në‚˜ëŠ” ê·¸ë…€ë¥¼ ë¶€ë‹´ìŠ¤ëŸ½ê²Œ í•´ì„œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-6", title: "ì—”ë”© 6", summary: "\"ìš°ë¦¬ ì£¼ë§ì— ì»¤í”¼ í•œ ì” í• ë˜ìš”? ì•„, ë¬¼ë¡  ì œê°€ ê¹... ì•„ë‹ˆ ì‚´ê²Œìš”.\"\nì–´ë¼, ê·¸ë…€ê°€ ì›ƒëŠ”ë‹¤. \nê³„ì† ì›ƒìœ¼ë©° ì¡°ìš©íˆ ë©€ì–´ì ¸ê°€ëŠ” ê·¸ë…€... \n\në‚˜ëŠ” ê·¸ë…€ë¥¼ ë¶€ë‹´ìŠ¤ëŸ½ê²Œ í•´ì„œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C006A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C006B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S007",
                    name: "ì”¬ 7",
                    content: "ê·¸ë…€ì˜ ëˆˆì´ ë°˜ì§ì¸ë‹¤. ëŒ€ì²´ ì»¤í”¼ë¥¼ ì–¼ë§ˆë‚˜ ì¢‹ì•„í•˜ëŠ” ê±°ì•¼...\në¶€ì§€ëŸ°íˆ ìŒì‹ì ê³¼ ì¹´í˜ë¥¼ ê²€ìƒ‰í•´ì„œ ì•½ì†ì„ ì¡ì•˜ë‹¤.\nê·¸ëŸ°ë° ë§Œë‚˜ì„œ ë¬´ìŠ¨ ëŒ€í™”ë¥¼ í•˜ì§€?",
                    isEnding: false,
                    choices: [
                        { id: "C007A", label: "ì»¤ë°ì•„ì›ƒì„ í•œë‹¤.", outcome: "continue", nextSceneId: "S009" },
                        { id: "C007B", label: "ì¢‹ì•„í•œë‹¤ê³  ê³ ë°±í•œë‹¤.", outcome: "continue", nextSceneId: "S010" }
                    ]
                },
                {
                    id: "S008",
                    name: "ì”¬ 8",
                    content: "\"ì•„, ì €ëŠ” ì‚¬ëŒ ë§ì€ ê³³ì€ ì¢€...\"\n\në‚˜ëŠ” ì§‘í•©ê¸ˆì§€ê·œì •ì„ ì•ˆ ì§€í‚¤ëŠ” ì†”ë¡œê°€ ë˜ì—ˆë‹¤.\nì½”ë¡œë‚˜ ì‹œêµ­ì´ì—ˆë‹¤.\n",
                    isEnding: true,
                    endingInfo: { code: "END-8", title: "ì—”ë”© 8", summary: "\"ì•„, ì €ëŠ” ì‚¬ëŒ ë§ì€ ê³³ì€ ì¢€...\"\n\në‚˜ëŠ” ì§‘í•©ê¸ˆì§€ê·œì •ì„ ì•ˆ ì§€í‚¤ëŠ” ì†”ë¡œê°€ ë˜ì—ˆë‹¤.\nì½”ë¡œë‚˜ ì‹œêµ­ì´ì—ˆë‹¤.\n" },
                    choices: [
                        { id: "C008A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C008B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S009",
                    name: "ì”¬ 9",
                    content: "íƒ€íŒŒìŠ¤ë¥¼ ì¦ê¸°ê³  ì¹´í˜ì— ì™”ë‹¤. \në§›ë‚œ ì»¤í”¼ë¥¼ ë§ˆì…”ì„œ ê·¸ëŸ°ì§€ ê¸°ë¶„ì´ ì¢‹ì•„ë³´ì´ëŠ” ê·¸ë…€.\në°”ë¡œ ì§€ê¸ˆì´ íƒ€ì´ë°ì´ë‹¤.\n",
                    isEnding: false,
                    choices: [
                        { id: "C009A", label: "ì €, ì—¬ì ì¢‹ì•„í•´ìš”...", outcome: "continue", nextSceneId: "S011" },
                        { id: "C009B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S010",
                    name: "ì”¬ 10",
                    content: "íƒ€íŒŒìŠ¤ë¥¼ ì¦ê¸°ê³  ì¹´í˜ì— ì™”ë‹¤. \në§›ë‚œ ì»¤í”¼ë¥¼ ë§ˆì…”ì„œ ê·¸ëŸ°ì§€ ê¸°ë¶„ì´ ì¢‹ì•„ë³´ì´ëŠ” ê·¸ë…€.\në°”ë¡œ ì§€ê¸ˆì´ íƒ€ì´ë°ì¸ë°... ì£½ì–´ë„ ì…ì´ ë–¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.\nê·¸ë…€ê°€ ë‚  ì˜ì•„í•˜ê²Œ ë°”ë¼ë³¸ë‹¤. ë¬´ìŠ¨ ë§ì´ë¼ë„ í•´ì•¼ í•˜ëŠ”ë°...",
                    isEnding: false,
                    choices: [
                        { id: "C010A", label: "ì €, í¬... í¬... ê·¸ëƒ¥ ì—¬ì ì¢‹ì•„í•´ìš”.", outcome: "continue", nextSceneId: "S011" },
                        { id: "C010B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S011",
                    name: "ì”¬ 11",
                    content: "ê·¸ë…€ê°€ ì‹±ê¸‹ ì›ƒëŠ”ë‹¤. \nì´ì–´ì§€ëŠ” ë§ì— ë‚œ ê·¸ë§Œ ì •ì‹ ì´ í˜¼ë¯¸í•´ì§€ê³  ë§ì•˜ë‹¤.\n\n\"ì €ë„ í˜¸ê°ìˆì–´ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C011A", label: "ì–´... ê·¸... ë„¤??? ë‚˜ëŠ” ê·¸ë§Œ ê³ ì¥ë‚˜ê³  ë§ì•˜ë‹¤.", outcome: "continue", nextSceneId: "S012" },
                        { id: "C011B", label: "ê°ì‚¬í•©ë‹ˆë‹¤.", outcome: "continue", nextSceneId: "S013" }
                    ]
                },
                {
                    id: "S012",
                    name: "ì”¬ 12",
                    content: "ë‚˜ë„ í˜¸ê°ì´ ìˆë‹¤ë‹ˆ? ë‚´ê°€ ê³ ë°±ì„ í–ˆì—ˆë‚˜?\ní˜¼ë€ìŠ¤ëŸ¬ìš´ ê°€ìš´ë° í™˜í•˜ê²Œ ì›ƒëŠ” ê·¸ë…€ì˜ ì–¼êµ´ë§Œ ëˆˆì— ë“¤ì–´ì˜¨ë‹¤.\nì•„ì°¨, ë‚´ê°€ ë˜ ë©í•˜ë‹ˆ ìˆì—ˆë„¤.",
                    isEnding: false,
                    choices: [
                        { id: "C012A", label: "í˜¹ì‹œë‚˜ í•´ì„œ ë§ì”€ë“œë¦¬ëŠ”ë°, ì € í¬ìˆ˜ì”¨ ëª¸ ë³´ê³  ì¢‹ì•„í•˜ëŠ” ê±° ì•„ë‹™ë‹ˆë‹¤.", outcome: "continue", nextSceneId: "S014" },
                        { id: "C012B", label: "ì œê°€ ë‚®ì ¸ë°¤ì´ê±°ë“ ìš”.", outcome: "continue", nextSceneId: "S015" }
                    ]
                },
                {
                    id: "S013",
                    name: "ì”¬ 13",
                    content: "ì ê¹, ì§€ê¸ˆ ë‚˜ë„ ëª¨ë¥´ê²Œ ê±°ì ˆ... í•œ ê±´ê°€?\n\në¯¸ë™ ì—†ì´ ì°¨ë¶„í•˜ê²Œ ë‚´ ì–˜ê¸°ë¥¼ ë“£ëŠ” ê·¸ë…€ ì•ì—ì„œ\në‚˜ëŠ” ê·¸ë ‡ê²Œ ì˜ˆì˜ë°”ë¥´ê²Œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-13", title: "ì—”ë”© 13", summary: "ì ê¹, ì§€ê¸ˆ ë‚˜ë„ ëª¨ë¥´ê²Œ ê±°ì ˆ... í•œ ê±´ê°€?\n\në¯¸ë™ ì—†ì´ ì°¨ë¶„í•˜ê²Œ ë‚´ ì–˜ê¸°ë¥¼ ë“£ëŠ” ê·¸ë…€ ì•ì—ì„œ\në‚˜ëŠ” ê·¸ë ‡ê²Œ ì˜ˆì˜ë°”ë¥´ê²Œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C013A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C013B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S014",
                    name: "ì”¬ 14",
                    content: "\"ì•„... ì§„ì§œìš”?\"\nì™ ì§€ ì‹¤ë§ìŠ¤ëŸ¬ì›Œë³´ì´ëŠ” ê·¸ë…€. ë‚œ ì„ ë¹„ê°™ì€ ë§¤ë ¥ì„ ë°œì‚°í–ˆëŠ”ë° ì™œ ì‹¤ë§í•˜ì§€?\n\nê·¸ë…€ëŠ” ì¹¨ëŒ€ì—ì„  ì„ ë¹„ë³´ë‹¤ ëŒì‡ ë¥¼ ì„ í˜¸í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ëª¨ë¥¸ ì±„ \në‚œ ì–´ì•ˆì´ ë²™ë²™í•œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-14", title: "ì—”ë”© 14", summary: "\"ì•„... ì§„ì§œìš”?\"\nì™ ì§€ ì‹¤ë§ìŠ¤ëŸ¬ì›Œë³´ì´ëŠ” ê·¸ë…€. ë‚œ ì„ ë¹„ê°™ì€ ë§¤ë ¥ì„ ë°œì‚°í–ˆëŠ”ë° ì™œ ì‹¤ë§í•˜ì§€?\n\nê·¸ë…€ëŠ” ì¹¨ëŒ€ì—ì„  ì„ ë¹„ë³´ë‹¤ ëŒì‡ ë¥¼ ì„ í˜¸í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ëª¨ë¥¸ ì±„ \në‚œ ì–´ì•ˆì´ ë²™ë²™í•œ ì†”ë¡œê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C014A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C014B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S015",
                    name: "ì”¬ 15",
                    content: "\"ì•„, ë„¤...\"\në°©ê¸ˆ ëˆˆì´ ë°˜ì§ì¸ ê²ƒ ê°™ì€ë°... ê¸°ë¶„ íƒ“ì´ê² ì§€. \në‹¹í™©í•´ì„œ ì•„ë¬´ ë§ì´ë‚˜ ì§–ëŠ” ë‚´ê²Œ ê·¸ë…€ê°€ ì œì•ˆí•´ì˜¨ë‹¤.\n\"ìš°ë¦¬ ë§Œë‚˜ë´ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C015A", label: "ë„¤, ì¢‹ì•„ìš”.", outcome: "continue", nextSceneId: "S016" },
                        { id: "C015B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S016",
                    name: "ì”¬ 16",
                    content: "í¬ìˆ˜ì”¨ê°€ ë‚´ ì¸ë…€ë¼ë‹ˆ!\ní•˜ì§€ë§Œ ì•„ì§ ì–¼ë–¨ë–¨í•˜ë‹¤. \ní•œì°¸ì„ ë” íš¡ì„¤ìˆ˜ì„¤í•˜ì ê·¸ë…€ê°€ ì˜ì•„í•˜ë‹¤ëŠ” ë“¯ ë‹¤ì‹œ ë¬¼ì–´ë³¸ë‹¤.\n\"ìš°ë¦¬ ë§Œë‚˜ë³´ìë‹ˆê¹Œìš”?\"",
                    isEnding: false,
                    choices: [
                        { id: "C016A", label: "ë„¤!!! ì¢‹ì•„ìš”......???", outcome: "continue", nextSceneId: "S017" },
                        { id: "C016B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S017",
                    name: "ì”¬ 17",
                    content: "\"ì—°ì£¼ì”¨... ì§€ê¸ˆ ì œê°€ í•œ ë§ ì´í•´í•˜ëŠ” ê±° ë§ì•„ìš”?\"",
                    isEnding: false,
                    choices: [
                        { id: "C017A", label: "ì‚¬ì‹¤ ë¬´ìŠ¨ ë§ì¸ì§€ ì˜ ëª¨ë¥´ê² ì–´ìš”.", outcome: "continue", nextSceneId: "S018" },
                        { id: "C017B", label: "ì™œ ìê¾¸ ë¬¼ì–´ë³´ì§€...? ì¼ë‹¨ ì´í•´í–ˆë‹¤ê³  ê°€ì˜¤ë¥¼ ì¡ëŠ”ë‹¤.", outcome: "continue", nextSceneId: "S019" }
                    ]
                },
                {
                    id: "S018",
                    name: "ì”¬ 18",
                    content: "\"ì‚¬ì‹¤... ë¬´ìŠ¨ ë§ì¸ì§€ ëª¨ë¥´ê² ì–´ìš”.\"\nì†”ì§í•˜ê²Œ ë§í•˜ì ê·¸ë…€ê°€ í”¼ì‹ ì›ƒëŠ”ë‹¤.\n\"ë§ˆì§€ë§‰ìœ¼ë¡œ ë§í• ê²Œìš”. ì—°ì£¼ì”¨, ì €ë‘ ì‚¬ê·€ìëŠ” ë§ì´ì—ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C018A", label: "ì¢‹ì•„ìš”! ì €ë„... í¬ìˆ˜ì”¨ ì¢‹ì•„í•´ìš”.", outcome: "continue", nextSceneId: "S020" },
                        { id: "C018B", label: "...ì¢‹ì•„ìš”. (ì¿¨í•˜ê²Œ ëŒ€ë‹µí•œë‹¤)", outcome: "continue", nextSceneId: "S021" }
                    ]
                },
                {
                    id: "S019",
                    name: "ì”¬ 19",
                    content: "\"ì—°ì£¼ì”¨... ì™œ ê±°ì§“ë§ì„ í•˜ëŠ” ê±°ì˜ˆìš”?\"\n\nê°€ì˜¤ë¥¼ ì„ íƒí•œ ë‚˜ëŠ” ì†”ë¡œ ê°€ì˜¤ê°€ì´ê±°ê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-19", title: "ì—”ë”© 19", summary: "\"ì—°ì£¼ì”¨... ì™œ ê±°ì§“ë§ì„ í•˜ëŠ” ê±°ì˜ˆìš”?\"\n\nê°€ì˜¤ë¥¼ ì„ íƒí•œ ë‚˜ëŠ” ì†”ë¡œ ê°€ì˜¤ê°€ì´ê±°ê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C019A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C019B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S020",
                    name: "ì”¬ 20",
                    content: "\"ì•Œì•„ìš”.\" í¬ìˆ˜ê°€ ë‹¹ì—°í•˜ë‹¤ëŠ” ë“¯ì´ ë§í•œë‹¤.\n\"ë‹¤ í‹° ë‚¬ê±°ë“ ìš”. ê·€ì—¬ì› ì–´ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C020A", label: "ì–´ë–»ê²Œ í‹°ê°€ ë‚¬ì–´ìš”?", outcome: "continue", nextSceneId: "S032" },
                        { id: "C020B", label: "ì¼ë¶€ëŸ¬ í‹° ë‚¸ ê±°ì˜ˆìš”. (ê°€ì˜¤ë¥¼ ì§€í‚¨ë‹¤)", outcome: "continue", nextSceneId: "S023" }
                    ]
                },
                {
                    id: "S021",
                    name: "ì”¬ 21",
                    content: "\"ì—°ì£¼ì”¨ëŠ” ì •ë§ ê±°ì§“ë§ì„ ëª» í•˜ë„¤ìš”. \në§ì€ í‰ëª…ìŠ¤ëŸ¬ì›Œë„ ì¢‹ì•„í•˜ëŠ” ê²Œ ëˆˆë¹›ì— ë‹¤ í‹°ë‚˜ìš”. \nê·¸ê²ƒë§ˆì €ë„ ê·€ì—¬ì›Œìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C021A", label: "ì–´ë–»ê²Œ í‹°ê°€ ë‚¬ì–´ìš”?", outcome: "continue", nextSceneId: "S032" },
                        { id: "C021B", label: "ì¼ë¶€ëŸ¬ í‹° ë‚¸ ê±°ì˜ˆìš”.", outcome: "continue", nextSceneId: "S023" }
                    ]
                },
                {
                    id: "S023",
                    name: "ì”¬ 23",
                    content: "\"ì •ë§ìš”?\"\ní¬ìˆ˜ê°€ ë” ê°€ê¹Œì´ ë‹¤ê°€ì˜¨ë‹¤. ì‹¬ì¥ì´ ë¯¸ì¹œ ë“¯ì´ ë›´ë‹¤.\n\"ê·¸ëŸ¼ ì§€ê¸ˆ ë‘ê·¼ê±°ë¦¬ëŠ” í‹° ë‚˜ëŠ” ê²ƒë„ ë‹¤ ê³„ì‚°ëœ ê±°ì˜ˆìš”?\"\n\nì´ ëˆˆë¹›... ê±°ì§“ë§í•˜ë©´ ì•ˆ ë  ê²ƒ ê°™ë‹¤.",
                    isEnding: false,
                    choices: [
                        { id: "C023A", label: "ì•„ë‡¨, ì§€ê¸ˆì€ ì§„ì§œ ë–¨ë ¤ìš”...", outcome: "continue", nextSceneId: "S024" },
                        { id: "C023B", label: "ë‹¹ì—°í•˜ì£ . (ëê¹Œì§€ ê°„ë‹¤)", outcome: "continue", nextSceneId: "S025" }
                    ]
                },
                {
                    id: "S024",
                    name: "ì”¬ 24",
                    content: "\"ì €ë„ìš”.\"\ní¬ìˆ˜ê°€ ìê¸° ê°€ìŠ´ì— ë‚´ ì†ì„ ê°€ì ¸ë‹¤ ëŒ„ë‹¤. ì‹¬ì¥ì´ ë¹ ë¥´ê²Œ ë›°ê³  ìˆë‹¤.\n\"ìš°ë¦¬ ë‘˜ ë‹¤ ë¹ ë¥´ê²Œ ë›°ë„¤ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C024A", label: "ì•ìœ¼ë¡œë„ ê°™ì´ ë›°ì—ˆìœ¼ë©´ ì¢‹ê² ì–´ìš”.", outcome: "continue", nextSceneId: "S026" },
                        { id: "C024B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S025",
                    name: "ì”¬ 25",
                    content: "\"ì—°ì£¼ì”¨... ì™œ ê±°ì§“ë§ì„ í•˜ëŠ” ê±°ì˜ˆìš”?\"\n\nê°€ì˜¤ë¥¼ ì„ íƒí•œ ë‚˜ëŠ” ì†”ë¡œ ê°€ì˜¤ê°€ì´ê±°ê°€ ë˜ì—ˆë‹¤.",
                    isEnding: true,
                    endingInfo: { code: "END-25", title: "ì—”ë”© 25", summary: "\"ì—°ì£¼ì”¨... ì™œ ê±°ì§“ë§ì„ í•˜ëŠ” ê±°ì˜ˆìš”?\"\n\nê°€ì˜¤ë¥¼ ì„ íƒí•œ ë‚˜ëŠ” ì†”ë¡œ ê°€ì˜¤ê°€ì´ê±°ê°€ ë˜ì—ˆë‹¤." },
                    choices: [
                        { id: "C025A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C025B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S026",
                    name: "ì”¬ 26",
                    content: "\"ê°™ì´ ë›°ìêµ¬ìš”? ì—°ì£¼ì”¨ë„ ë‹¬ë¦¬ê¸° í•´ìš”?\"\ní¬ìˆ˜ì˜ ëˆˆì´ ë˜ ë°˜ì§ì¸ë‹¤. \në­”ì§„ ëª¨ë¥´ì§€ë§Œ ì‹¤ìˆ˜í•œ ê¸°ë¶„ì´ ë“ ë‹¤.",
                    isEnding: false,
                    choices: [
                        { id: "C026A", label: "ë„¤, ì–¼ë§ˆ ì „ë¶€í„° ë‹¬ë¦¬ê³  ìˆì–´ìš”. (ì´ë”°ê°€ ë°”ë¡œ ìš´ë™í™” ì£¼ë¬¸í•´ì•¼ì§€)", outcome: "continue", nextSceneId: "S027" },
                        { id: "C026B", label: "ì•„ë‡¨, ì „ ë‹¬ë¦¬ê¸°ëŠ” ì •ë§ ì‹«ì–´ìš”.", outcome: "continue", nextSceneId: "S028" }
                    ]
                },
                {
                    id: "S027",
                    name: "ì”¬ 27",
                    content: "\"ê·¸ëŸ¼ ì²« ë°ì´íŠ¸ë¡œ ìš©ì‚°ì—­ê¹Œì§€ ë‹¬ë¦° ë‹¤ìŒì— ì˜í™” ë³´ëŠ” ê²Œ ì–´ë•Œìš”?\"\ní¬ìˆ˜ê°€ ì´ìƒí•œ ê¸°ì‹œê°ì´ ë“œëŠ” ì œì•ˆì„ í–ˆë‹¤.\nì•„ë‹ˆ, ê·¼ë° ê¸°ì‹œê°ì´ ë¬¸ì œê°€ ì•„ë‹ˆì–ì•„?",
                    isEnding: false,
                    choices: [
                        { id: "C027A", label: "ë¯¸ì•ˆí•˜ì§€ë§Œ ì²« ë°ì´íŠ¸ë¶€í„° ë•€ í˜ë¦¬ëŠ” ê±´ ì•„ë‹Œ ê²ƒ ê°™ì•„ìš”.", outcome: "continue", nextSceneId: "S029" },
                        { id: "C027B", label: "ì¢‹ì£ . (ê°€ì˜¤ê°€ì´ê±° ì¶œë™!)", outcome: "continue", nextSceneId: "S030" }
                    ]
                },
                {
                    id: "S028",
                    name: "ì”¬ 28",
                    content: "\"ì—°ì£¼ì”¨ëŠ” ì •ë§ ì†”ì§í•œ ê²Œ ë§¤ë ¥ì´ì—ìš”. ê·€ì—¬ì›Œìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C028A", label: "ê·€ì—¬ìš´ ê±° í‹°ë‚¬ì–´ìš”?", outcome: "continue", nextSceneId: "S032" },
                        { id: "C028B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S029",
                    name: "ì”¬ 29",
                    content: "\"ë‹¹ì—°í•˜ì£ . ê·¸ëƒ¥ ì¥ë‚œì³ ë³¸ ê±°ì˜ˆìš”. ë‹¤ìŒ ì£¼ë§ì— ì •ì‹ìœ¼ë¡œ ì²« ë°ì´íŠ¸ í•´ìš”.\"\n",
                    isEnding: false,
                    choices: [
                        { id: "C029A", label: "ì¢‹ì•„ìš”. ê·¸ ì „ì— ë‚´ì¼ë„ íšŒì‚¬ì—ì„œ ë§Œë‚˜ìš”", outcome: "continue", nextSceneId: "S031" },
                        { id: "C029B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S030",
                    name: "ì”¬ 30",
                    content: "\"ì—°ì£¼ì”¨ëŠ” ì •ë§ ê±°ì§“ë§ì„ ëª» í•˜ë„¤ìš”. \nì‹«ì€ ê²Œ ëˆˆë¹›ì— ë‹¤ í‹°ë‚˜ìš”. ê·¸ê²ƒë§ˆì €ë„ ê·€ì—¬ì›Œìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C030A", label: "ê·€ì—¬ìš´ ê±° í‹° ë‚¬ì–´ìš”?", outcome: "continue", nextSceneId: "S032" },
                        { id: "C030B", label: "íœ´, ì •ë§ ë›°ì–´ì•¼ í•˜ëŠ” ì¤„ ì•Œì•˜ì–´ìš”.", outcome: "continue", nextSceneId: "S033" }
                    ]
                },
                {
                    id: "S031",
                    name: "ì”¬ 31",
                    content: "[ì¶”ê°€]ë°ì´íŠ¸ í•˜ë ¤ê³  ë§Œë‚˜ëŠ” ì¥ë©´",
                    isEnding: false,
                    choices: [
                        { id: "C031A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C031B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S032",
                    name: "ì”¬ 32",
                    content: "\"ì—¬ê¸°ì— í‹° ë‚¬ì–´ìš”.\"\ní¬ìˆ˜ê°€ ë‚´ ë³¼ì„ ì†ê°€ë½ìœ¼ë¡œ ì½• ì°ë”ë‹ˆ ë½€ë½€ë¥¼ í•œë‹¤.\nì´ ì—¬ìëŠ” ì™œ ê·€ì—½ê¸°ê¹Œì§€ í•œê±°ì§€?",
                    isEnding: false,
                    choices: [
                        { id: "C032A", label: "í—¤í—¤, ìš°ë¦¬ ì¬ë°Œê²Œ ë°ì´íŠ¸ í•´ìš”.", outcome: "continue", nextSceneId: "S031" },
                        { id: "C032B", label: "ë„ˆë¬´ ê·€ì—¬ì›Œì„œ ëª» ì°¸ê² ì–´ìš”. ìš°ë¦¬ ì˜ë˜ìš”?", outcome: "continue", nextSceneId: "S035" }
                    ]
                },
                {
                    id: "S033",
                    name: "ì”¬ 33",
                    content: "\"ë‹¹ì—°í•˜ì£ . ê·¸ëƒ¥ ì¥ë‚œì³ ë³¸ ê±°ì˜ˆìš”. ë‹¤ìŒ ì£¼ë§ì— ì •ì‹ìœ¼ë¡œ ì²« ë°ì´íŠ¸ í•´ìš”.\"",
                    isEnding: false,
                    choices: [
                        { id: "C033A", label: "ì¢‹ì•„ìš”. ê·¸ ì „ì— ë‚´ì¼ë„ íšŒì‚¬ì—ì„œ ë§Œë‚˜ìš”", outcome: "continue", nextSceneId: "S031" },
                        { id: "C033B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                },
                {
                    id: "S035",
                    name: "ì”¬ 35",
                    content: "ì•„ì§ ë‚®ì¸",
                    isEnding: false,
                    choices: [
                        { id: "C035A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C035B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                }
            ]
        };

        // ==================== STATE ====================
        let currentSceneId = null;
        let crumbs = [];

        // ==================== HELPERS ====================
        function qs(sel) {
            return document.querySelector(sel);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            qs('#' + screenId).classList.add('active');
        }

        function findScene(sceneId) {
            return STORY.scenes.find(s => s.id === sceneId);
        }

        function validate(story) {
            const errors = [];

            if (!story.startSceneId) {
                errors.push('ì‹œì‘ ì”¬ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            } else if (!story.scenes.find(s => s.id === story.startSceneId)) {
                errors.push(`ì‹œì‘ ì”¬ ${story.startSceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }

            story.scenes.forEach(scene => {
                if (!scene.choices || scene.choices.length !== 2) {
                    errors.push(`ì”¬ ${scene.id}: ì„ íƒì§€ê°€ ì •í™•íˆ 2ê°œì—¬ì•¼ í•©ë‹ˆë‹¤.`);
                }

                if (scene.choices) {
                    scene.choices.forEach((choice, idx) => {
                        if (choice.outcome === 'continue' && !choice.nextSceneId) {
                            errors.push(`ì”¬ ${scene.id}, ì„ íƒì§€ ${idx + 1}: outcomeì´ 'continue'ì¸ë° nextSceneIdê°€ ì—†ìŠµë‹ˆë‹¤.`);
                        }

                        if (choice.outcome === 'continue' && choice.nextSceneId) {
                            if (!story.scenes.find(s => s.id === choice.nextSceneId)) {
                                errors.push(`ì”¬ ${scene.id}, ì„ íƒì§€ ${idx + 1}: nextSceneId ${choice.nextSceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                            }
                        }
                    });
                }
            });

            return errors;
        }

        function mergeStory(base, incoming) {
            if (incoming.title) base.title = incoming.title;
            if (incoming.startSceneId) base.startSceneId = incoming.startSceneId;

            if (incoming.scenes && Array.isArray(incoming.scenes)) {
                incoming.scenes.forEach(inScene => {
                    const existingIdx = base.scenes.findIndex(s => s.id === inScene.id);

                    if (existingIdx >= 0) {
                        const existing = base.scenes[existingIdx];

                        if (inScene.name) existing.name = inScene.name;
                        if (inScene.content !== undefined) existing.content = inScene.content;
                        if (inScene.isEnding !== undefined) existing.isEnding = inScene.isEnding;
                        if (inScene.endingInfo) existing.endingInfo = { ...existing.endingInfo, ...inScene.endingInfo };

                        if (inScene.choices && Array.isArray(inScene.choices)) {
                            inScene.choices.forEach((inChoice, idx) => {
                                if (idx < 2) {
                                    const existingChoice = existing.choices[idx];
                                    if (existingChoice && existingChoice.id === inChoice.id) {
                                        if (inChoice.label) existingChoice.label = inChoice.label;
                                        if (inChoice.outcome) existingChoice.outcome = inChoice.outcome;
                                        if (inChoice.nextSceneId !== undefined) existingChoice.nextSceneId = inChoice.nextSceneId;
                                    } else {
                                        existing.choices[idx] = inChoice;
                                    }
                                }
                            });
                        }
                    } else {
                        base.scenes.push(inScene);
                    }
                });
            }

            return base;
        }

        function downloadJSON(obj, filename) {
            const json = JSON.stringify(obj, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ==================== GAME LOGIC ====================
        function startGame() {
            currentSceneId = STORY.startSceneId;
            crumbs = [];
            showScene(currentSceneId);
        }

        function showScene(sceneId) {
            const scene = findScene(sceneId);
            if (!scene) {
                alert(`ì”¬ ${sceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œì‘ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.`);
                startGame();
                return;
            }

            currentSceneId = sceneId;
            crumbs.push(scene.name);

            // Check if ending scene
            if (scene.isEnding) {
                showEndingScreen('failure', scene.endingInfo?.summary || scene.content);
                return;
            }

            showScreen('main-screen');

            qs('#scene-content').textContent = scene.content || '';

            const choices = scene.choices || [];
            qs('#choice-a-text').textContent = choices[0]?.label || 'Option A';
            qs('#choice-b-text').textContent = choices[1]?.label || 'Option B';

            // Store choice data
            qs('#choice-a').dataset.outcome = choices[0]?.outcome || 'continue';
            qs('#choice-a').dataset.nextSceneId = choices[0]?.nextSceneId || '';
            qs('#choice-b').dataset.outcome = choices[1]?.outcome || 'continue';
            qs('#choice-b').dataset.nextSceneId = choices[1]?.nextSceneId || '';
        }

        function handleChoice(choiceElement) {
            const outcome = choiceElement.dataset.outcome;
            const nextSceneId = choiceElement.dataset.nextSceneId;

            switch (outcome) {
                case 'continue':
                    if (nextSceneId) {
                        showScene(nextSceneId);
                    } else {
                        alert('ë‹¤ìŒ ì”¬ì´ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                    break;

                case 'success':
                    showEndingScreen('success', 'ë‹¹ì‹ ì€ ìš©ê¸°ë¥¼ ë‚´ì–´ ì§„ì‹¬ì„ ì „í–ˆê³ , ê·¸ ì‚¬ëŒë„ ê°™ì€ ë§ˆìŒì´ì—ˆë‹¤.\n\në‘ ì‚¬ëŒì€ ì†ì„ ì¡ê³  í•¨ê»˜ ê±·ê¸° ì‹œì‘í•œë‹¤.\n\nì´ê²ƒì´ ì§„ì •í•œ ì‚¬ë‘ì˜ ì‹œì‘ì´ë‹¤.');
                    break;

                case 'failure':
                    showEndingScreen('failure', '\"ê³ ë§™ì§€ë§Œ... ë‚˜ëŠ” ë„ˆë¥¼ ì¹œêµ¬ë¡œë§Œ ìƒê°í•´.\"\n\nê·¸ ì‚¬ëŒì˜ ë§ì— ë‹¹ì‹ ì˜ ë§ˆìŒì€ ë¬´ë„ˆì§„ë‹¤.\n\nì–´ìƒ‰í•œ ì¹¨ë¬µì´ íë¥´ê³ , ë‘ ì‚¬ëŒì€ ì„œë¡œ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ê±¸ì–´ê°„ë‹¤.');
                    break;
            }
        }

        function showEndingScreen(type, storyText) {
            if (type === 'success') {
                showScreen('ending-success-screen');
                qs('#success-story-text').textContent = storyText || '';
            } else {
                showScreen('ending-failure-screen');
                qs('#failure-story-text').textContent = storyText || '';
            }
        }

        function restartGame() {
            currentSceneId = null;
            crumbs = [];
            startGame();
        }

        // ==================== EXPORT/IMPORT ====================
        function exportJSON() {
            const filename = `${STORY.title.replace(/\s+/g, '-')}-${Date.now()}.json`;
            downloadJSON(STORY, filename);
            alert('JSONì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.');
        }

        function importJSON(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const incoming = JSON.parse(e.target.result);

                    const errors = validate(incoming);
                    if (errors.length > 0) {
                        alert('JSON ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                        return;
                    }

                    STORY = mergeStory(STORY, incoming);
                    alert('JSONì„ ì„±ê³µì ìœ¼ë¡œ ë³‘í•©í–ˆìŠµë‹ˆë‹¤.');
                } catch (err) {
                    alert('JSON íŒŒì‹± ì‹¤íŒ¨: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // ==================== STORY PREVIEW SYSTEM ====================
        let allPaths = [];
        let currentPreviewView = 'paths';
        let expandedPanel = null;
        let previewSceneIndex = 0;

        // DFSë¡œ ëª¨ë“  ê²½ë¡œ ì°¾ê¸°
        function findAllPaths() {
            const paths = [];
            const visited = new Set();

            function dfs(sceneId, path, choices) {
                if (visited.has(sceneId) && path.length > 20) return; // ë¬´í•œ ë£¨í”„ ë°©ì§€

                const scene = findScene(sceneId);
                if (!scene) return;

                const newPath = [...path, { scene, choiceLabel: null }];

                if (scene.isEnding) {
                    paths.push({
                        steps: newPath,
                        choices: choices,
                        ending: scene.endingInfo || { code: scene.id, title: scene.name, summary: scene.content }
                    });
                    return;
                }

                const validChoices = scene.choices.filter(c => c.label && c.nextSceneId);

                if (validChoices.length === 0) {
                    // ë§‰ë‹¤ë¥¸ ê¸¸ (ë¯¸ì™„ì„± ê²½ë¡œ)
                    paths.push({
                        steps: newPath,
                        choices: choices,
                        ending: { code: 'INCOMPLETE', title: 'ë¯¸ì™„ì„±', summary: 'ì´ ê²½ë¡œëŠ” ì•„ì§ ì™„ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' }
                    });
                    return;
                }

                validChoices.forEach((choice, idx) => {
                    const lastStep = newPath[newPath.length - 1];
                    lastStep.choiceLabel = choice.label;
                    lastStep.choiceIdx = idx;

                    visited.add(sceneId);
                    dfs(choice.nextSceneId, [...newPath], [...choices, choice.label]);
                    visited.delete(sceneId);
                });
            }

            dfs(STORY.startSceneId, [], []);
            return paths;
        }

        // ê²½ë¡œë¥¼ HTMLë¡œ ë Œë”ë§
        function renderPaths(paths) {
            if (paths.length === 0) {
                return '<div style="color:#666;text-align:center;padding:20px;">ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            return paths.map((path, idx) => {
                const stepsHtml = path.steps.map((step, stepIdx) => {
                    const contentPreview = (step.scene.content || '').substring(0, 50) + (step.scene.content?.length > 50 ? '...' : '');
                    let html = `
                        <div class="path-step">
                            <span class="path-scene-id">${step.scene.id}</span>
                            <span class="path-scene-content">${contentPreview}</span>
                    `;
                    if (step.choiceLabel) {
                        html += `<span class="path-choice">"${step.choiceLabel}"</span>`;
                    }
                    html += '</div>';
                    return html;
                }).join('');

                const endingTag = path.ending.code === 'INCOMPLETE'
                    ? '<span class="path-ending-tag" style="background:#999;">ë¯¸ì™„ì„±</span>'
                    : `<span class="path-ending-tag">${path.ending.code}</span>`;

                return `
                    <div class="story-path">
                        <div class="path-header">
                            ğŸ“ ê²½ë¡œ ${idx + 1}
                            ${endingTag}
                        </div>
                        ${stepsHtml}
                        <div class="path-ending">ğŸ”š ${path.ending.summary?.substring(0, 80) || 'ì—”ë”©'}${path.ending.summary?.length > 80 ? '...' : ''}</div>
                    </div>
                `;
            }).join('');
        }

        // ì—”ë”©ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ë Œë”ë§
        function renderByEndings(paths) {
            const endingGroups = {};

            paths.forEach(path => {
                const code = path.ending.code;
                if (!endingGroups[code]) {
                    endingGroups[code] = {
                        ending: path.ending,
                        paths: []
                    };
                }
                endingGroups[code].paths.push(path);
            });

            return Object.values(endingGroups).map(group => {
                const pathsHtml = group.paths.map((path, idx) => {
                    const route = path.steps.map(s => s.scene.id).join(' â†’ ');
                    return `<div style="font-size:12px;color:#666;margin:5px 0;">ê²½ë¡œ ${idx + 1}: ${route}</div>`;
                }).join('');

                const tagStyle = group.ending.code === 'INCOMPLETE' ? 'background:#999;' : '';

                return `
                    <div class="ending-summary">
                        <div class="ending-summary-header">
                            <span class="ending-code" style="${tagStyle}">${group.ending.code}</span>
                            <span class="ending-title">${group.ending.title || ''}</span>
                            <span class="ending-paths-count">(${group.paths.length}ê°œ ê²½ë¡œ)</span>
                        </div>
                        <div style="font-size:12px;color:#666;margin-bottom:8px;">${group.ending.summary?.substring(0, 100) || ''}${group.ending.summary?.length > 100 ? '...' : ''}</div>
                        ${pathsHtml}
                    </div>
                `;
            }).join('');
        }

        // ì”¬ ë§µ ë Œë”ë§
        function renderSceneMap() {
            const scenes = STORY.scenes;
            const connections = [];

            scenes.forEach(scene => {
                if (scene.choices) {
                    scene.choices.forEach(choice => {
                        if (choice.nextSceneId) {
                            connections.push({
                                from: scene.id,
                                to: choice.nextSceneId,
                                label: choice.label?.substring(0, 20) || ''
                            });
                        }
                    });
                }
            });

            const endingScenes = scenes.filter(s => s.isEnding);
            const normalScenes = scenes.filter(s => !s.isEnding);

            let html = `
                <div style="margin-bottom:15px;">
                    <strong>ì´ ì”¬:</strong> ${scenes.length}ê°œ |
                    <strong>ì—”ë”©:</strong> ${endingScenes.length}ê°œ |
                    <strong>ì—°ê²°:</strong> ${connections.length}ê°œ
                </div>
                <div style="font-size:12px;">
                    <div style="margin-bottom:10px;"><strong>ì—”ë”© ì”¬:</strong></div>
            `;

            endingScenes.forEach(scene => {
                html += `<span style="display:inline-block;background:#E64398;color:white;padding:2px 8px;border-radius:10px;margin:2px;font-size:11px;">${scene.id}</span>`;
            });

            html += `<div style="margin:15px 0 10px;"><strong>ì”¬ ì—°ê²° ë§µ:</strong></div>`;

            // ì‹œì‘ì”¬ë¶€í„° íŠ¸ë¦¬ í˜•íƒœë¡œ í‘œì‹œ
            const renderTree = (sceneId, depth = 0, visited = new Set()) => {
                if (visited.has(sceneId) || depth > 5) return '';
                visited.add(sceneId);

                const scene = findScene(sceneId);
                if (!scene) return '';

                const indent = '&nbsp;&nbsp;'.repeat(depth);
                const isEnding = scene.isEnding;
                const style = isEnding ? 'color:#E64398;font-weight:bold;' : '';

                let html = `<div style="${style}">${indent}${depth > 0 ? 'â””â”€ ' : ''}${scene.id} ${isEnding ? 'ğŸ”š' : ''}</div>`;

                if (!isEnding && scene.choices) {
                    scene.choices.forEach(choice => {
                        if (choice.nextSceneId && !visited.has(choice.nextSceneId)) {
                            html += renderTree(choice.nextSceneId, depth + 1, new Set(visited));
                        }
                    });
                }

                return html;
            };

            html += `<div style="font-family:monospace;font-size:11px;line-height:1.8;max-height:200px;overflow-y:auto;">${renderTree(STORY.startSceneId)}</div>`;

            return html;
        }

        // í”„ë¦¬ë·° ì½˜í…ì¸  ì—…ë°ì´íŠ¸
        function updatePreviewContent() {
            const container = qs('#preview-content');

            if (currentPreviewView === 'paths') {
                if (allPaths.length === 0) {
                    allPaths = findAllPaths();
                }
                container.innerHTML = renderPaths(allPaths);
            } else if (currentPreviewView === 'endings') {
                if (allPaths.length === 0) {
                    allPaths = findAllPaths();
                }
                container.innerHTML = renderByEndings(allPaths);
            } else if (currentPreviewView === 'map') {
                container.innerHTML = renderSceneMap();
            }
        }

        // í˜„ì¬ ì”¬ íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateCurrentScenePanel(sceneId) {
            const scene = findScene(sceneId);
            if (!scene) return;

            qs('#current-scene-id').textContent = `${scene.id}: ${scene.name}`;
            qs('#current-scene-text').textContent = scene.content || '';

            const choices = scene.choices || [];
            qs('#current-choice-a').textContent = choices[0]?.label || '(ì—†ìŒ)';
            qs('#current-choice-a-next').textContent = choices[0]?.nextSceneId ? `â†’ ${choices[0].nextSceneId}` : '';
            qs('#current-choice-b').textContent = choices[1]?.label || '(ì—†ìŒ)';
            qs('#current-choice-b-next').textContent = choices[1]?.nextSceneId ? `â†’ ${choices[1].nextSceneId}` : '';

            // ì”¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            const select = qs('#scene-select');
            if (select.options.length === 0) {
                STORY.scenes.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.id;
                    option.textContent = `${s.id}: ${s.name}`;
                    select.appendChild(option);
                });
            }
            select.value = sceneId;

            // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
            previewSceneIndex = STORY.scenes.findIndex(s => s.id === sceneId);
        }

        // íŒ¨ë„ í† ê¸€
        function togglePanel(panelName) {
            const panel = qs(`#panel-${panelName}`);
            const tab = qs(`#tab-${panelName}`);

            if (panel.classList.contains('collapsed')) {
                panel.classList.remove('collapsed');
                tab.classList.remove('collapsed');
                tab.classList.add('active');
            } else {
                panel.classList.add('collapsed');
                tab.classList.add('collapsed');
                tab.classList.remove('active');
            }
        }

        // íŒ¨ë„ í™•ì¥/ì¶•ì†Œ
        function toggleExpand() {
            const previewPanel = qs('#panel-preview');
            const currentPanel = qs('#panel-current');
            const expandBtn = qs('#expand-btn');

            if (expandedPanel === null) {
                // í˜„ì¬ ì—´ë¦° íŒ¨ë„ ì¤‘ í•˜ë‚˜ë¥¼ í™•ì¥
                if (!previewPanel.classList.contains('collapsed')) {
                    previewPanel.classList.add('expanded');
                    currentPanel.classList.add('collapsed');
                    expandedPanel = 'preview';
                } else if (!currentPanel.classList.contains('collapsed')) {
                    currentPanel.classList.add('expanded');
                    previewPanel.classList.add('collapsed');
                    expandedPanel = 'current';
                }
                expandBtn.textContent = 'â¬‡ ì¶•ì†Œ';
            } else {
                // ì›ë˜ëŒ€ë¡œ ë³µì›
                previewPanel.classList.remove('expanded', 'collapsed');
                currentPanel.classList.remove('expanded', 'collapsed');
                qs('#tab-preview').classList.remove('collapsed');
                qs('#tab-preview').classList.add('active');
                qs('#tab-current').classList.remove('collapsed');
                qs('#tab-current').classList.add('active');
                expandedPanel = null;
                expandBtn.textContent = 'â¬† í™•ì¥';
            }
        }

        // í”„ë¦¬ë·° ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initPreviewSystem() {
            // í”„ë¦¬ë·° íƒ­ ì´ë²¤íŠ¸
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentPreviewView = tab.dataset.view;
                    updatePreviewContent();
                });
            });

            // íŒ¨ë„ íƒ­ ì´ë²¤íŠ¸
            qs('#tab-preview').addEventListener('click', () => togglePanel('preview'));
            qs('#tab-current').addEventListener('click', () => togglePanel('current'));

            // í™•ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
            qs('#expand-btn').addEventListener('click', toggleExpand);

            // ì”¬ ë„¤ë¹„ê²Œì´ì…˜
            qs('#nav-prev').addEventListener('click', () => {
                if (previewSceneIndex > 0) {
                    previewSceneIndex--;
                    updateCurrentScenePanel(STORY.scenes[previewSceneIndex].id);
                }
            });

            qs('#nav-next').addEventListener('click', () => {
                if (previewSceneIndex < STORY.scenes.length - 1) {
                    previewSceneIndex++;
                    updateCurrentScenePanel(STORY.scenes[previewSceneIndex].id);
                }
            });

            qs('#scene-select').addEventListener('change', (e) => {
                updateCurrentScenePanel(e.target.value);
            });

            // ì´ˆê¸° ì½˜í…ì¸  ë¡œë“œ
            updatePreviewContent();
            updateCurrentScenePanel(STORY.startSceneId);
        }

        // ==================== EVENT HANDLERS ====================
        function init() {
            const errors = validate(STORY);
            if (errors.length > 0) {
                alert('ì´ˆê¸° ìŠ¤í† ë¦¬ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                return;
            }

            // Choice handlers
            qs('#choice-a').addEventListener('click', function() {
                handleChoice(this);
            });

            qs('#choice-b').addEventListener('click', function() {
                handleChoice(this);
            });

            // Restart buttons
            qs('#restart-success').addEventListener('click', restartGame);
            qs('#restart-failure').addEventListener('click', restartGame);

            // Export button
            qs('#btn-export').addEventListener('click', exportJSON);

            // Import button
            qs('#input-import').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    importJSON(e.target.files[0]);
                    e.target.value = '';
                }
            });

            // Initialize preview system
            initPreviewSystem();

            // Start game automatically
            startGame();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
