<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch! Love - Game</title>
    <!--
      ë””ìžì¸/ë¬¸êµ¬ëŠ” ì›ë³¸ ìœ ì§€, ìŠ¤í† ë¦¬ëŠ” ë‚´ìž¥ ìƒìˆ˜ë¡œ ìž…ë ¥, JSON import/export ì§€ì›
      ë‹¨ì¼ HTML íŒŒì¼ë¡œ ì™„ê²°. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬/ë²ˆë“¤ëŸ¬ ë¶ˆê°€.

      ë³‘í•© ê·œì¹™(Merge Rules):
      1. Scene ë³‘í•©: scene.id ê¸°ì¤€
         - ì¡´ìž¬í•˜ë©´: ë¹ˆ ê°’ì´ ì•„ë‹Œ í•„ë“œë§Œ ë®ì–´ì“°ê¸°
         - ì—†ìœ¼ë©´: scenes ë°°ì—´ì— ì¶”ê°€
      2. Choice ë³‘í•©: choice.id ê¸°ì¤€
         - ì¡´ìž¬í•˜ë©´: label, outcome, nextSceneId ê°±ì‹ 
         - ì—†ìœ¼ë©´: í•´ë‹¹ ì”¬ì˜ choices[index] êµì²´
      3. startSceneId, titleì€ incoming ê°’ì´ ìžˆìœ¼ë©´ ê°±ì‹ 
    -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==================== Utility Bar ==================== */
        .utility-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .utility-bar button,
        .utility-bar label {
            padding: 8px 15px;
            background: white;
            border: 2px solid #E64398;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #E64398;
            transition: all 0.2s;
            font-family: 'Lato', sans-serif;
        }

        .utility-bar button:hover,
        .utility-bar label:hover {
            background: #E64398;
            color: white;
        }

        .utility-bar input[type="file"] {
            display: none;
        }

        /* ==================== Common ==================== */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ==================== Introduction Screen ==================== */
        #introduction-screen {
            background: #F0EBF4;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .wave-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .wave {
            position: absolute;
            width: 150%;
            height: 200px;
            left: -25%;
        }

        .wave-1 {
            background: #A1C3D1;
            top: 0;
            border-radius: 0 0 50% 50%;
            transform: rotate(-2deg);
        }

        .wave-2 {
            background: #F172A1;
            top: 15%;
            border-radius: 50% 50% 50% 50%;
            height: 180px;
            transform: rotate(1deg);
        }

        .wave-3 {
            background: #B39BC8;
            top: 30%;
            border-radius: 50% 50% 50% 50%;
            height: 160px;
            transform: rotate(-1deg);
        }

        .wave-4 {
            background: #E64398;
            top: 45%;
            border-radius: 50% 50% 50% 50%;
            height: 140px;
            transform: rotate(2deg);
        }

        .wave-5 {
            background: #A1C3D1;
            bottom: 0;
            border-radius: 50% 50% 0 0;
            height: 220px;
            transform: rotate(-1deg);
        }

        .container {
            text-align: center;
            z-index: 10;
            padding: 40px;
        }

        .title-wrapper {
            background: white;
            padding: 80px 100px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(230, 67, 152, 0.3);
            border: 4px solid #F172A1;
            position: relative;
        }

        .title-wrapper::before,
        .title-wrapper::after {
            content: '';
            position: absolute;
            width: 28px;
            height: 28px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .title-wrapper::before {
            top: 20px;
            left: 30px;
        }

        .title-wrapper::after {
            bottom: 20px;
            right: 30px;
        }

        h1 {
            font-size: 84px;
            color: #E64398;
            margin-bottom: 0;
            letter-spacing: 8px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 18px;
            color: #B39BC8;
            margin-top: 20px;
            font-weight: 400;
            letter-spacing: 3px;
        }

        .start-prompt {
            margin-top: 50px;
            font-size: 16px;
            color: #A1C3D1;
            animation: blink 2s infinite;
            font-weight: 400;
            letter-spacing: 2px;
            cursor: pointer;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .floating-heart {
            position: absolute;
            width: 40px;
            height: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        .floating-heart:nth-child(1) {
            top: 10%;
            left: 15%;
            animation-delay: 0s;
        }

        .floating-heart:nth-child(2) {
            top: 20%;
            right: 10%;
            width: 30px;
            height: 30px;
            animation-delay: 1s;
        }

        .floating-heart:nth-child(3) {
            bottom: 15%;
            left: 10%;
            width: 35px;
            height: 35px;
            animation-delay: 2s;
        }

        .floating-heart:nth-child(4) {
            bottom: 25%;
            right: 20%;
            animation-delay: 1.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* ==================== Main Game Screen ==================== */
        #main-screen {
            background: #F0EBF4;
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
        }

        .wave-decoration {
            position: absolute;
            z-index: 0;
        }

        .wave-top-left {
            top: 0;
            left: 0;
            width: 300px;
            height: 150px;
            background: #A1C3D1;
            border-radius: 0 0 100% 0;
            opacity: 0.4;
        }

        .wave-bottom-right {
            bottom: 0;
            right: 0;
            width: 350px;
            height: 180px;
            background: #B39BC8;
            border-radius: 100% 0 0 0;
            opacity: 0.4;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .game-title {
            font-size: 42px;
            color: #E64398;
            margin-bottom: 10px;
            font-weight: 900;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .header::before,
        .header::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            top: 50%;
            transform: translateY(-50%);
        }

        .header::before {
            left: calc(50% - 200px);
        }

        .header::after {
            right: calc(50% - 200px);
        }

        .scene-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 15px 40px rgba(179, 155, 200, 0.2);
            border: 4px solid #F172A1;
        }

        .scene-image-placeholder {
            width: 100%;
            height: 300px;
            background: #A1C3D1;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .scene-image-placeholder::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: #B39BC8;
            border-radius: 50% 50% 0 0;
        }

        .scene-image-placeholder span {
            font-size: 24px;
            color: white;
            font-weight: 700;
            z-index: 1;
            letter-spacing: 2px;
        }

        .scene-text {
            font-size: 18px;
            line-height: 1.8;
            color: #5a5a5a;
            text-align: center;
            padding: 30px;
            background: #F0EBF4;
            border-radius: 15px;
            border-left: 6px solid #E64398;
            font-weight: 400;
            white-space: pre-wrap;
        }

        .choices-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .choice-card {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(161, 195, 209, 0.2);
            border: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .choice-card:nth-child(1) {
            border-color: #A1C3D1;
        }

        .choice-card:nth-child(1):hover {
            border-color: #F172A1;
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(241, 114, 161, 0.3);
        }

        .choice-card:nth-child(1):hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 1;
        }

        .choice-card:nth-child(2) {
            border-color: #B39BC8;
        }

        .choice-card:nth-child(2):hover {
            border-color: #E64398;
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(230, 67, 152, 0.3);
        }

        .choice-card:nth-child(2):hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 1;
        }

        .choice-content {
            position: relative;
            z-index: 1;
        }

        .choice-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 25px;
            display: block;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .choice-card:nth-child(1) .choice-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .choice-card:nth-child(2) .choice-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .choice-label {
            font-size: 14px;
            color: #B39BC8;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .choice-text {
            font-size: 20px;
            color: #333;
            line-height: 1.6;
            font-weight: 400;
        }

        .choice-card:hover .choice-text {
            color: #E64398;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .choices-container {
                flex-direction: column;
            }
        }

        /* ==================== Ending Success Screen ==================== */
        #ending-success-screen {
            background: #F172A1;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .wave-celebration {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .celebrate-wave {
            position: absolute;
            width: 130%;
            left: -15%;
        }

        .celebrate-wave-1 {
            background: #E64398;
            height: 140px;
            top: 10%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .celebrate-wave-2 {
            background: #B39BC8;
            height: 160px;
            top: 35%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .celebrate-wave-3 {
            background: #A1C3D1;
            height: 180px;
            bottom: 15%;
            border-radius: 50%;
            opacity: 0.4;
        }

        .ending-container {
            max-width: 850px;
            width: 100%;
            background: white;
            border-radius: 35px;
            padding: 70px 60px;
            box-shadow: 0 25px 70px rgba(230, 67, 152, 0.4);
            text-align: center;
            border: 6px solid #E64398;
            z-index: 10;
            position: relative;
        }

        .ending-container::before,
        .ending-container::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .ending-container::before {
            top: 25px;
            left: 25px;
        }

        .ending-container::after {
            bottom: 25px;
            right: 25px;
        }

        .icon-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .story-text-area {
            background: #F0EBF4;
            border: 5px solid #F172A1;
            border-radius: 25px;
            padding: 50px;
            min-height: 280px;
            margin-bottom: 50px;
            font-size: 18px;
            line-height: 1.9;
            color: #666;
            text-align: left;
            font-weight: 400;
            white-space: pre-wrap;
        }

        .story-text-area::before {
            content: '[Your beautiful love story concludes here...]';
            color: #F172A1;
            font-style: italic;
            display: block;
            text-align: center;
            margin-bottom: 25px;
            font-size: 16px;
            font-weight: 300;
        }

        .ending-message {
            font-size: 64px;
            color: #E64398;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 8px;
            margin-bottom: 30px;
        }

        .congratulations {
            font-size: 24px;
            color: #E64398;
            font-style: italic;
            margin-top: 25px;
            font-weight: 400;
        }

        .success-decoration {
            margin-top: 40px;
            padding: 30px;
            background: #B39BC8;
            border-radius: 20px;
            color: white;
            font-size: 20px;
            box-shadow: 0 10px 30px rgba(179, 155, 200, 0.3);
            font-weight: 400;
        }

        .hearts-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .hearts-row .heart-icon {
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .hearts-row .heart-icon:nth-child(1) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(2) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E64398'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(3) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(4) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        .hearts-row .heart-icon:nth-child(5) {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F172A1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
        }

        /* ==================== Ending Failure Screen ==================== */
        #ending-failure-screen {
            background: #A1C3D1;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        #ending-failure-screen .ending-container {
            border-color: #B39BC8;
        }

        #ending-failure-screen .ending-container::before,
        #ending-failure-screen .ending-container::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23B39BC8'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 0.3;
        }

        #ending-failure-screen .icon-container {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23A1C3D1'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            width: 80px;
            height: 80px;
            opacity: 0.5;
            animation: none;
        }

        #ending-failure-screen .story-text-area {
            border-color: #B39BC8;
            padding: 40px;
            min-height: 250px;
            margin-bottom: 40px;
        }

        #ending-failure-screen .story-text-area::before {
            content: '[Story text will appear here]';
            color: #B39BC8;
        }

        #ending-failure-screen .ending-message {
            font-size: 48px;
            color: #A1C3D1;
            letter-spacing: 6px;
        }

        .encouragement {
            font-size: 20px;
            color: #B39BC8;
            font-style: italic;
            margin-top: 20px;
            font-weight: 400;
        }

        .retry-hint {
            margin-top: 40px;
            padding: 25px;
            background: #F172A1;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 400;
        }

        .wave-background {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .bg-wave {
            position: absolute;
            width: 120%;
            left: -10%;
        }

        .bg-wave-1 {
            background: #B39BC8;
            height: 150px;
            top: 20%;
            border-radius: 50%;
            opacity: 0.3;
        }

        .bg-wave-2 {
            background: #F172A1;
            height: 120px;
            bottom: 25%;
            border-radius: 50%;
            opacity: 0.3;
        }

        /* Restart button for ending screens */
        .restart-button {
            margin-top: 40px;
            padding: 15px 40px;
            background: #E64398;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lato', sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .restart-button:hover {
            background: #F172A1;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(230, 67, 152, 0.3);
        }
    </style>
</head>
<body>
    <!-- Utility Bar -->
    <div class="utility-bar">
        <button id="btn-export" aria-label="JSON ë‚´ë³´ë‚´ê¸°">ðŸ’¾ Export</button>
        <label aria-label="JSON ë¶ˆëŸ¬ì˜¤ê¸°">
            ðŸ“‚ Import
            <input type="file" id="input-import" accept=".json">
        </label>
    </div>

    <!-- Introduction Screen -->
    <div id="introduction-screen" class="screen active">
        <div class="wave-layer">
            <div class="wave wave-1"></div>
            <div class="wave wave-2"></div>
            <div class="wave wave-3"></div>
            <div class="wave wave-4"></div>
            <div class="wave wave-5"></div>
        </div>

        <div class="floating-heart"></div>
        <div class="floating-heart"></div>
        <div class="floating-heart"></div>
        <div class="floating-heart"></div>

        <div class="container">
            <div class="title-wrapper">
                <h1>CATCH! LOVE</h1>
                <div class="subtitle">A ROMANTIC ADVENTURE AWAITS</div>
            </div>
            <div class="start-prompt" id="start-trigger" tabindex="0">CLICK TO BEGIN YOUR JOURNEY</div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="main-screen" class="screen">
        <div class="wave-decoration wave-top-left"></div>
        <div class="wave-decoration wave-bottom-right"></div>

        <div class="game-container">
            <div class="header">
                <h1 class="game-title">ðŸ’• CATCH! LOVE ðŸ’•</h1>
            </div>

            <div class="scene-container">
                <div class="scene-image-placeholder">
                    <span>SCENE IMAGE</span>
                </div>
                <div class="scene-text" id="scene-content"></div>
            </div>

            <div class="choices-container">
                <div class="choice-card" id="choice-a" data-choice="0">
                    <div class="choice-content">
                        <div class="choice-icon"></div>
                        <div class="choice-label">Option A</div>
                        <div class="choice-text" id="choice-a-text"></div>
                    </div>
                </div>

                <div class="choice-card" id="choice-b" data-choice="1">
                    <div class="choice-content">
                        <div class="choice-icon"></div>
                        <div class="choice-label">Option B</div>
                        <div class="choice-text" id="choice-b-text"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ending Success Screen -->
    <div id="ending-success-screen" class="screen">
        <div class="wave-celebration">
            <div class="celebrate-wave celebrate-wave-1"></div>
            <div class="celebrate-wave celebrate-wave-2"></div>
            <div class="celebrate-wave celebrate-wave-3"></div>
        </div>

        <div class="ending-container">
            <div class="icon-container"></div>

            <div class="story-text-area" id="success-story-text"></div>

            <div class="hearts-row">
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
                <div class="heart-icon"></div>
            </div>

            <div class="ending-message">THE END</div>

            <div class="congratulations">
                Congratulations! You've caught love! ðŸŽ‰
            </div>

            <div class="success-decoration">
                True love conquers all. Your hearts are now forever intertwined! ðŸ’‘
            </div>

            <button class="restart-button" id="restart-success">Restart Journey</button>
        </div>
    </div>

    <!-- Ending Failure Screen -->
    <div id="ending-failure-screen" class="screen">
        <div class="wave-background">
            <div class="bg-wave bg-wave-1"></div>
            <div class="bg-wave bg-wave-2"></div>
        </div>

        <div class="ending-container">
            <div class="icon-container"></div>

            <div class="story-text-area" id="failure-story-text"></div>

            <div class="ending-message">MAYBE NEXT TIME...</div>

            <div class="encouragement">
                Every ending is a new beginning. Try again? ðŸ’«
            </div>

            <div class="retry-hint">
                Love is a journey of many paths. Choose differently and discover new possibilities! ðŸŒˆ
            </div>

            <button class="restart-button" id="restart-failure">Restart Journey</button>
        </div>
    </div>

    <script>
        // ==================== STORY DATA ====================
        let STORY = {
            title: "Catch! Love",
            startSceneId: "S001",
            scenes: [
                {
                    id: "S001",
                    name: "í•™êµ ë³µë„ì—ì„œ",
                    content: "ë°©ê³¼ í›„ ì¡°ìš©í•œ ë³µë„ë¥¼ ê±·ê³  ìžˆëŠ”ë°, ì•žì—ì„œ ëˆ„êµ°ê°€ ë‹¤ê°€ì˜¨ë‹¤.\nê·¸ê²ƒì€ ë‹¹ì‹ ì´ ì˜¤ëž˜ì „ë¶€í„° ë§ˆìŒì— ë‘ê³  ìžˆë˜ ê·¸ ì‚¬ëžŒì´ë‹¤.\n\n\"ìž ê¹... ì‹œê°„ ê´œì°®ì•„?\"",
                    isEnding: false,
                    choices: [
                        {
                            id: "C001A",
                            label: "\"ì‘, ê´œì°®ì•„. ë¬´ìŠ¨ ì¼ì´ì•¼?\"",
                            outcome: "continue",
                            nextSceneId: "S002"
                        },
                        {
                            id: "C001B",
                            label: "\"ë¯¸ì•ˆ, ê¸‰í•œ ì¼ì´ ìžˆì–´ì„œ...\"",
                            outcome: "continue",
                            nextSceneId: "S003"
                        }
                    ]
                },
                {
                    id: "S002",
                    name: "ê³ ë°±ì„ ë“£ë‹¤",
                    content: "\"ì‚¬ì‹¤ì€... ë„¤ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ ìžˆì–´.\"\n\nê·¸ ì‚¬ëžŒì€ ìž ì‹œ ë§ì„¤ì´ë”ë‹ˆ ìš©ê¸°ë¥¼ ë‚´ì–´ ë§í•œë‹¤.\n\n\"ë‚˜... ë„ˆë¥¼ ì¢‹ì•„í•´. ì˜¤ëž˜ì „ë¶€í„°.\"\n\nì‹¬ìž¥ì´ ë›´ë‹¤. ì´ ìˆœê°„ì„ ì–´ë–»ê²Œ ë³´ë‚¼ ê²ƒì¸ê°€?",
                    isEnding: false,
                    choices: [
                        {
                            id: "C002A",
                            label: "\"ë‚˜ë„... ë„ˆë¥¼ ì¢‹ì•„í•´.\"",
                            outcome: "success",
                            nextSceneId: ""
                        },
                        {
                            id: "C002B",
                            label: "\"ê³ ë§ˆìš´ë°... ì¹œêµ¬ë¡œ ì§€ë‚´ê³  ì‹¶ì–´.\"",
                            outcome: "failure",
                            nextSceneId: ""
                        }
                    ]
                },
                {
                    id: "S003",
                    name: "ë†“ì¹œ ê¸°íšŒ",
                    content: "\"ì•„... ê·¸ëž˜. ì•Œì•˜ì–´.\"\n\nê·¸ ì‚¬ëžŒì€ ì•„ì‰¬ìš´ í‘œì •ìœ¼ë¡œ ëŒì•„ì„ ë‹¤.\n\në©°ì¹  í›„, ê·¸ ì‚¬ëžŒì´ ë‹¤ë¥¸ ëˆ„êµ°ê°€ì™€ í•¨ê»˜ ì›ƒìœ¼ë©° ê±·ëŠ” ëª¨ìŠµì„ ë³¸ë‹¤.\n\në‹¹ì‹ ì€ ê·¸ë•Œì˜ ì„ íƒì„ í›„íšŒí•œë‹¤.",
                    isEnding: true,
                    endingInfo: {
                        code: "END-MISS",
                        title: "ë†“ì¹œ ì‚¬ëž‘",
                        summary: "ë•Œë¡œëŠ” ìš©ê¸° ìžˆëŠ” ì„ íƒì´ í•„ìš”í•œ ìˆœê°„ì´ ìžˆë‹¤.\në‹¹ì‹ ì€ ê·¸ ìˆœê°„ì„ ë†“ì³¤ë‹¤."
                    },
                    choices: [
                        { id: "C003A", label: "", outcome: "continue", nextSceneId: "" },
                        { id: "C003B", label: "", outcome: "continue", nextSceneId: "" }
                    ]
                }
            ]
        };

        // ==================== STATE ====================
        let currentSceneId = null;
        let crumbs = [];

        // ==================== HELPERS ====================
        function qs(sel) {
            return document.querySelector(sel);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            qs('#' + screenId).classList.add('active');
        }

        function findScene(sceneId) {
            return STORY.scenes.find(s => s.id === sceneId);
        }

        function validate(story) {
            const errors = [];

            if (!story.startSceneId) {
                errors.push('ì‹œìž‘ ì”¬ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            } else if (!story.scenes.find(s => s.id === story.startSceneId)) {
                errors.push(`ì‹œìž‘ ì”¬ ${story.startSceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }

            story.scenes.forEach(scene => {
                if (!scene.choices || scene.choices.length !== 2) {
                    errors.push(`ì”¬ ${scene.id}: ì„ íƒì§€ê°€ ì •í™•ížˆ 2ê°œì—¬ì•¼ í•©ë‹ˆë‹¤.`);
                }

                if (scene.choices) {
                    scene.choices.forEach((choice, idx) => {
                        if (choice.outcome === 'continue' && !choice.nextSceneId) {
                            errors.push(`ì”¬ ${scene.id}, ì„ íƒì§€ ${idx + 1}: outcomeì´ 'continue'ì¸ë° nextSceneIdê°€ ì—†ìŠµë‹ˆë‹¤.`);
                        }

                        if (choice.outcome === 'continue' && choice.nextSceneId) {
                            if (!story.scenes.find(s => s.id === choice.nextSceneId)) {
                                errors.push(`ì”¬ ${scene.id}, ì„ íƒì§€ ${idx + 1}: nextSceneId ${choice.nextSceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                            }
                        }
                    });
                }
            });

            return errors;
        }

        function mergeStory(base, incoming) {
            if (incoming.title) base.title = incoming.title;
            if (incoming.startSceneId) base.startSceneId = incoming.startSceneId;

            if (incoming.scenes && Array.isArray(incoming.scenes)) {
                incoming.scenes.forEach(inScene => {
                    const existingIdx = base.scenes.findIndex(s => s.id === inScene.id);

                    if (existingIdx >= 0) {
                        const existing = base.scenes[existingIdx];

                        if (inScene.name) existing.name = inScene.name;
                        if (inScene.content !== undefined) existing.content = inScene.content;
                        if (inScene.isEnding !== undefined) existing.isEnding = inScene.isEnding;
                        if (inScene.endingInfo) existing.endingInfo = { ...existing.endingInfo, ...inScene.endingInfo };

                        if (inScene.choices && Array.isArray(inScene.choices)) {
                            inScene.choices.forEach((inChoice, idx) => {
                                if (idx < 2) {
                                    const existingChoice = existing.choices[idx];
                                    if (existingChoice && existingChoice.id === inChoice.id) {
                                        if (inChoice.label) existingChoice.label = inChoice.label;
                                        if (inChoice.outcome) existingChoice.outcome = inChoice.outcome;
                                        if (inChoice.nextSceneId !== undefined) existingChoice.nextSceneId = inChoice.nextSceneId;
                                    } else {
                                        existing.choices[idx] = inChoice;
                                    }
                                }
                            });
                        }
                    } else {
                        base.scenes.push(inScene);
                    }
                });
            }

            return base;
        }

        function downloadJSON(obj, filename) {
            const json = JSON.stringify(obj, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ==================== GAME LOGIC ====================
        function startGame() {
            currentSceneId = STORY.startSceneId;
            crumbs = [];
            showScene(currentSceneId);
        }

        function showScene(sceneId) {
            const scene = findScene(sceneId);
            if (!scene) {
                alert(`ì”¬ ${sceneId}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œìž‘ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.`);
                showScreen('introduction-screen');
                return;
            }

            currentSceneId = sceneId;
            crumbs.push(scene.name);

            // Check if ending scene
            if (scene.isEnding) {
                showEndingScreen('failure', scene.endingInfo?.summary || scene.content);
                return;
            }

            showScreen('main-screen');

            qs('#scene-content').textContent = scene.content || '';

            const choices = scene.choices || [];
            qs('#choice-a-text').textContent = choices[0]?.label || 'Option A';
            qs('#choice-b-text').textContent = choices[1]?.label || 'Option B';

            // Store choice data
            qs('#choice-a').dataset.outcome = choices[0]?.outcome || 'continue';
            qs('#choice-a').dataset.nextSceneId = choices[0]?.nextSceneId || '';
            qs('#choice-b').dataset.outcome = choices[1]?.outcome || 'continue';
            qs('#choice-b').dataset.nextSceneId = choices[1]?.nextSceneId || '';
        }

        function handleChoice(choiceElement) {
            const outcome = choiceElement.dataset.outcome;
            const nextSceneId = choiceElement.dataset.nextSceneId;

            switch (outcome) {
                case 'continue':
                    if (nextSceneId) {
                        showScene(nextSceneId);
                    } else {
                        alert('ë‹¤ìŒ ì”¬ì´ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                    break;

                case 'success':
                    showEndingScreen('success', 'ë‹¹ì‹ ì€ ìš©ê¸°ë¥¼ ë‚´ì–´ ì§„ì‹¬ì„ ì „í–ˆê³ , ê·¸ ì‚¬ëžŒë„ ê°™ì€ ë§ˆìŒì´ì—ˆë‹¤.\n\në‘ ì‚¬ëžŒì€ ì†ì„ ìž¡ê³  í•¨ê»˜ ê±·ê¸° ì‹œìž‘í•œë‹¤.\n\nì´ê²ƒì´ ì§„ì •í•œ ì‚¬ëž‘ì˜ ì‹œìž‘ì´ë‹¤.');
                    break;

                case 'failure':
                    showEndingScreen('failure', '\"ê³ ë§™ì§€ë§Œ... ë‚˜ëŠ” ë„ˆë¥¼ ì¹œêµ¬ë¡œë§Œ ìƒê°í•´.\"\n\nê·¸ ì‚¬ëžŒì˜ ë§ì— ë‹¹ì‹ ì˜ ë§ˆìŒì€ ë¬´ë„ˆì§„ë‹¤.\n\nì–´ìƒ‰í•œ ì¹¨ë¬µì´ íë¥´ê³ , ë‘ ì‚¬ëžŒì€ ì„œë¡œ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ê±¸ì–´ê°„ë‹¤.');
                    break;
            }
        }

        function showEndingScreen(type, storyText) {
            if (type === 'success') {
                showScreen('ending-success-screen');
                qs('#success-story-text').textContent = storyText || '';
            } else {
                showScreen('ending-failure-screen');
                qs('#failure-story-text').textContent = storyText || '';
            }
        }

        function restartGame() {
            currentSceneId = null;
            crumbs = [];
            showScreen('introduction-screen');
        }

        // ==================== EXPORT/IMPORT ====================
        function exportJSON() {
            const filename = `${STORY.title.replace(/\s+/g, '-')}-${Date.now()}.json`;
            downloadJSON(STORY, filename);
            alert('JSONì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.');
        }

        function importJSON(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const incoming = JSON.parse(e.target.result);

                    const errors = validate(incoming);
                    if (errors.length > 0) {
                        alert('JSON ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                        return;
                    }

                    STORY = mergeStory(STORY, incoming);
                    alert('JSONì„ ì„±ê³µì ìœ¼ë¡œ ë³‘í•©í–ˆìŠµë‹ˆë‹¤.');
                } catch (err) {
                    alert('JSON íŒŒì‹± ì‹¤íŒ¨: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // ==================== EVENT HANDLERS ====================
        function init() {
            const errors = validate(STORY);
            if (errors.length > 0) {
                alert('ì´ˆê¸° ìŠ¤í† ë¦¬ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:\n' + errors.join('\n'));
                return;
            }

            // Start trigger
            qs('#start-trigger').addEventListener('click', startGame);
            qs('#start-trigger').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    startGame();
                }
            });

            // Choice handlers
            qs('#choice-a').addEventListener('click', function() {
                handleChoice(this);
            });

            qs('#choice-b').addEventListener('click', function() {
                handleChoice(this);
            });

            // Restart buttons
            qs('#restart-success').addEventListener('click', restartGame);
            qs('#restart-failure').addEventListener('click', restartGame);

            // Export button
            qs('#btn-export').addEventListener('click', exportJSON);

            // Import button
            qs('#input-import').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    importJSON(e.target.files[0]);
                    e.target.value = '';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
